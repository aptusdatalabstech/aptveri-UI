<!-- <div id="table1">
    <div class="card">
        <p-table
            *ngIf="audits"
            #dt1
            [value]="auditP"
            selectionMode="single"
            [rows]="5"
            [loading]="loadingP"
            [rowHover]="true"
            [paginator]="true"
            [rowsPerPageOptions]="[5, 10, 20]"
            [showCurrentPageReport]="true"
            [(selection)]="auditPSelection"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            responsiveLayout="scroll"
            [scrollable]="true"
            [globalFilterFields]="[
                'audit_program_uid',
                'ap_name',
                'ap_desc',
                'au_level_3_desc',
                'ap_schedule_date',
                'next_run',
                'frequency_id',
                'ap_schedule_time',
                'full_name'
            ]"
        >
            <ng-template pTemplate="caption">
                <div
                    class="table-header flex justify-content-between align-items-center"
                >
                    <span class="text-xl"
                        >List of Audit Program [{{ audits[0].audit_uid }} -
                        {{ audits[0].audit_name }}]</span
                    >
                    <span
                        class="flex justify-content-between align-items-center"
                    >
                        <span class="p-input-icon-left mb-2 md:mb-0">
                            <button
                                type="button"
                                pButton
                                pRipple
                                icon="pi pi-arrow-left"
                                (click)="backClicked()"
                                class="p-button-rounded p-button-info"
                                title="Back"
                                tooltipPosition="left"
                            ></button>

                            <button
                                [disabled]="!auditPSelection?.length > 0"
                                title="Run Tests"
                                pButton
                                pRipple
                                icon="pi pi-play"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="runProgram()"
                            ></button>
                            <button
                                title="New"
                                pButton
                                pRipple
                                icon="pi pi-plus"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="openP(null, 'new')"
                            ></button>
                            <button
                                [disabled]="auditPSelection?.length != 1"
                                title="Edit"
                                pButton
                                pRipple
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="openP(auditPSelection[0], 'edit')"
                            ></button>
                            <button
                                [disabled]="auditPSelection?.length != 1"
                                title="Delete"
                                pButton
                                pRipple
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="deleteProgram(auditPSelection[0])"
                            ></button>
                            <button
                                [disabled]="!auditPSelection?.length > 0"
                                title="Show Graph"
                                pButton
                                pRipple
                                icon="pi pi-chart-pie"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="getGraph()"
                            ></button>
                        </span>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <span class="p-input-icon-left mr-5">
                            <i class="pi pi-search"></i>
                            <input
                                pInputText
                                type="text"
                                (input)="
                                    dt.filterGlobal(
                                        $event.target.value,
                                        'contains'
                                    )
                                "
                                placeholder="Global Search"
                            /> </span
                    ></span>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pFrozenColumn style="min-width: 4rem">
                        <p-tableHeaderCheckbox
                            (click)="getTests()"
                        ></p-tableHeaderCheckbox>
                    </th>

                    <th pFrozenColumn style="min-width: 14rem">
                        <div class="flex align-items-center">
                            SCHEDULE STATUS
                        </div>
                    </th>

                    <th
                        pSortableColumn="audit_program_uid"
                        style="min-width: 14rem"
                    >
                        <div class="flex align-items-center">
                            AUDIT PROGRAM UID
                            <p-sortIcon field="audit_program_uid"></p-sortIcon>
                        </div>
                    </th>

                    <th pSortableColumn="ap_name" style="min-width: 14rem">
                        <div class="flex align-items-center">
                            AUDIT PROGRAM NAME
                            <p-sortIcon field="ap_name"></p-sortIcon>
                        </div>
                    </th>

                    <th pSortableColumn="ap_desc" style="min-width: 14rem">
                        <div class="flex align-items-center">
                            AUDIT DESCRIPTION
                            <p-sortIcon field="ap_desc"></p-sortIcon>
                        </div>
                    </th>

                    <th
                        pSortableColumn="au_level_3_desc"
                        style="min-width: 14rem"
                    >
                        <div class="flex align-items-center">
                            AUDIT UNIVERSE DESCRIPTION (LEVEL 3)
                            <p-sortIcon field="au_level_3_desc"></p-sortIcon>
                        </div>
                    </th>

                    <th
                        pSortableColumn="ap_schedule_date"
                        style="min-width: 14rem"
                    >
                        <div class="flex align-items-center">
                            SCHEDULE START DATE
                            <p-sortIcon field="ap_schedule_date"></p-sortIcon>
                        </div>
                    </th>

                    <th pSortableColumn="next_run" style="min-width: 14rem">
                        <div class="flex align-items-center">
                            SCHEDULE END DATE
                            <p-sortIcon field="next_run"></p-sortIcon>
                        </div>
                    </th>

                    <th pSortableColumn="frequency_id" style="min-width: 14rem">
                        <div class="flex align-items-center">
                            FREQUENCY
                            <p-sortIcon field="frequency_id"></p-sortIcon>
                        </div>
                    </th>

                    <th
                        pSortableColumn="ap_schedule_time"
                        style="min-width: 14rem"
                    >
                        <div class="flex align-items-center">
                            AP SCHEDULE TIME (HH24)
                            <p-sortIcon field="ap_schedule_time"></p-sortIcon>
                        </div>
                    </th>

                    <th pSortableColumn="full_name" style="min-width: 14rem">
                        <div class="flex align-items-center">
                            CREATED BY
                            <p-sortIcon field="ap_schedule_time"></p-sortIcon>
                        </div>
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
                <tr class="p-selectable-row">
                    <td pFrozenColumn class="text-base" style="max-width: 4rem">
                        <p-tableCheckbox
                            [value]="item"
                            (click)="selectRow(item)"
                        ></p-tableCheckbox>
                    </td>
                    <td pFrozenColumn>
                        <p-inputSwitch
                            *ngIf="item.frequency_id > 0"
                            (onChange)="changeStatus(item, $event)"
                            [(ngModel)]="item.schedule_enable"
                        ></p-inputSwitch>
                        <span class="text-base" *ngIf="item.frequency_id == 0">
                            N/A</span
                        >
                    </td>
                    <td class="text-base">{{ item.audit_program_uid }}</td>
                    <td class="text-base">{{ item.ap_name }}</td>
                    <td class="text-base">{{ item.ap_desc }}</td>
                    <td class="text-base">{{ item.au_level_3_desc }}</td>
                    <td class="text-base">
                        {{ item.ap_schedule_date | date }}
                    </td>
                    <td class="text-base">{{ item.next_run | date }}</td>
                    <td class="text-base">
                        {{ getFrequency(item.frequency_id) }}
                    </td>
                    <td class="text-base">
                        {{ getTwoDigit(item.ap_schedule_time) }}
                    </td>
                    <td class="text-base">{{ item.full_name }}</td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="11">No Audit found.</td>
                </tr>
            </ng-template>
        </p-table>
        <br />

        <p-table
            *ngIf="auditPSelection?.length"
            #dt2
            [value]="auditT"
            [rows]="5"
            [loading]="loadingT"
            [rowHover]="true"
            [paginator]="true"
            [rowsPerPageOptions]="[5, 10, 20]"
            [showCurrentPageReport]="true"
            [(selection)]="auditTSelection"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            responsiveLayout="scroll"
            [scrollable]="true"
            [globalFilterFields]="[
                'audit_test_uid',
                'audit_test_desc',
                'au_level_4_desc',
                'audit_risk',
                'control',
                'banner',
                'target_table',
                'script_defination',
                'script_presto',
                'script_sql',
                'results',
                'notes',
                'schedule_status',
                'schedule_start_datetime',
                'schedule_end_datetime',
                'last_run_date',
                'full_name'
            ]"
        >
            <ng-template pTemplate="caption">
                <div
                    class="table-header flex justify-content-between align-items-center"
                >
                    <span class="text-xl">List of Audit Test</span>
                    <span
                        class="flex justify-content-between align-items-center"
                    >
                        <span class="p-input-icon-left mb-2 md:mb-0">
                            <button
                                [disabled]="!auditTSelection?.length > 0"
                                title="Run Test"
                                pButton
                                pRipple
                                icon="pi pi-play"
                                class="p-button-rounded p-button-info"
                                (click)="runTest(auditTSelection)"
                            ></button>
                            <button
                                title="New"
                                pButton
                                pRipple
                                icon="pi pi-plus"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="openT(null, 'new')"
                                [disabled]="auditPSelection?.length != 1"
                            ></button>
                            <button
                                [disabled]="
                                    auditTSelection?.length != 1 ||
                                    auditTH?.length != 0
                                "
                                title="Edit"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="openT(auditTSelection[0], 'edit')"
                            ></button>
                            <button
                                [disabled]="
                                    auditTSelection?.length != 1 ||
                                    auditTH?.length != 0
                                "
                                title="Delete"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="deleteTest(auditTSelection[0])"
                            ></button
                        ></span>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span
                            class="p-input-icon-left mr-5"
                        >
                            <i class="pi pi-search"></i>
                            <input
                                pInputText
                                type="text"
                                (input)="
                                    dt.filterGlobal(
                                        $event.target.value,
                                        'contains'
                                    )
                                "
                                placeholder="Global Search"
                            /> </span
                    ></span>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pFrozenColumn style="max-width: 4rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>

                    <th pSortableColumn="audit_test_uid">
                        <div class="flex align-items-center">
                            AUDIT TEST UID
                            <p-sortIcon field="audit_test_uid"></p-sortIcon>
                        </div>
                    </th>

                    <th
                        pSortableColumn="audit_test_desc"
                        style="min-width: 14rem"
                    >
                        AUDIT TEST DESCRIPTION
                        <p-sortIcon field="audit_test_desc"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="au_level_4_desc"
                        style="min-width: 14rem"
                    >
                        AUDIT UNIVERESE LEVEL 4
                        <p-sortIcon field="au_level_4_desc"></p-sortIcon>
                    </th>
                    <th pSortableColumn="audit_risk" style="min-width: 14rem">
                        RISK DESCRIPTION
                        <p-sortIcon field="audit_risk"></p-sortIcon>
                    </th>
                    <th pSortableColumn="control" style="min-width: 14rem">
                        CONTROL DESCRIPTION
                        <p-sortIcon field="control"></p-sortIcon>
                    </th>
                    <th pSortableColumn="banner" style="min-width: 14rem">
                        DEPARTMENT DESCRIPTION
                        <p-sortIcon field="banner"></p-sortIcon>
                    </th>
                    <th pSortableColumn="target_table" style="min-width: 14rem">
                        TARGET TABLE<p-sortIcon
                            field="target_table"
                        ></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="script_defination"
                        style="min-width: 14rem"
                    >
                        SCRIPT DEFINATION
                        <p-sortIcon field="script_defination"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="script_presto"
                        style="min-width: 14rem"
                    >
                        FEDERATED SCRIPT
                        <p-sortIcon field="script_presto"></p-sortIcon>
                    </th>
                    <th pSortableColumn="script_sql" style="min-width: 14rem">
                        SQL SCRIPT
                        <p-sortIcon field="script_sql"></p-sortIcon>
                    </th>
                    <th pSortableColumn="result" style="min-width: 14rem">
                        RESULT
                        <p-sortIcon field="result"></p-sortIcon>
                    </th>
                    <th pSortableColumn="notes" style="min-width: 14rem">
                        NOTES
                        <p-sortIcon field="notes"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_status"
                        style="min-width: 14rem"
                    >
                        SCHEDULE STATUS
                        <p-sortIcon field="schedule_status"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_start_datetime"
                        style="min-width: 14rem"
                    >
                        SCHEDULE START DATE
                        <p-sortIcon
                            field="schedule_start_datetime"
                        ></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_end_datetime"
                        style="min-width: 14rem"
                    >
                        SCHEDULE END DATE
                        <p-sortIcon field="schedule_end_datetime"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="last_run_date"
                        style="min-width: 14rem"
                    >
                        LAST RUN DATE
                        <p-sortIcon field="last_run_date"></p-sortIcon>
                    </th>
                    <th pSortableColumn="full_name" style="min-width: 14rem">
                        CREATED BY
                        <p-sortIcon field="full_name"></p-sortIcon>
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
                <tr class="p-selectable-row">
                    <td pFrozenColumn class="text-base" style="max-width: 4rem">
                        <p-tableCheckbox
                            [value]="item"
                            (click)="selectTest(item)"
                        ></p-tableCheckbox>
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_test_uid }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_test_desc.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.au_level_4_desc }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_risk.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.control.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.banner }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.target_table }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_defination }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_presto.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_sql.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.results ? item.results : 'N/A' }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.notes }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.schedule_status }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.schedule_start_datetime | date }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.schedule_end_datetime | date }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.last_run_date | date }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.full_name }}
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="18">No Audit Tests found.</td>
                </tr>
            </ng-template>

            <ng-template pTemplate="loadingbody">
                <tr>
                    <td colspan="18">Loading Audit Tests data. Please wait.</td>
                </tr>
            </ng-template>
        </p-table>
        <br />
        <p-table
            *ngIf="auditTSelection?.length > 0 && auditPSelection?.length > 0"
            #dt3
            [value]="auditTH"
            [rows]="5"
            [loading]="loadingTH"
            [rowHover]="true"
            [paginator]="true"
            [rowsPerPageOptions]="[5, 10, 20]"
            [showCurrentPageReport]="true"
            (onRowSelect)="selecthistory()"
            (onRowUnselect)="selecthistory()"
            [(selection)]="auditTHSelection"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            responsiveLayout="scroll"
            [scrollable]="true"
            [globalFilterFields]="[
                'audit_history_uid',
                'audit_test_desc',
                'au_level_4_desc',
                'audit_risk',
                'control',
                'target_table',
                'script_defination',
                'script_presto',
                'script_sql',
                'results',
                'notes',
                'schedule_status',
                'schedule_start_datetime',
                'schedule_run_time',
                'created_date',
                'job_run_status_text',
                'error_message',
                'audit_run_status_text'
            ]"
        >
            <ng-template pTemplate="caption">
                <div
                    class="table-header flex justify-content-between align-items-center"
                >
                    <span class="text-xl">List of Audit Test History</span>
                    <span
                        class="flex justify-content-between align-items-center"
                    >
                        <span class="p-input-icon-left mb-2 md:mb-0">
                            <button
                                title="Refresh"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-refresh"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="refreshHistory()"
                            ></button>
                            &nbsp;
                            <button
                                title="Download Excel"
                                pButton
                                pRipple
                                icon="pi pi-file-excel"
                                class="p-button-rounded p-button-info"
                                [disabled]="auditTHSelection?.length < 1"
                                (click)="downloadExcel()"
                            ></button>

                            <button
                                [disabled]="auditTHSelection?.length != 1"
                                title="Delete"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="
                                    deleteAuditHistroy(auditTHSelection[0])
                                "
                            ></button
                        ></span>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <span class="p-input-icon-left mr-5">
                            <i class="pi pi-search"></i>
                            <input
                                pInputText
                                type="text"
                                (input)="
                                    dt.filterGlobal(
                                        $event.target.value,
                                        'contains'
                                    )
                                "
                                placeholder="Global Search"
                            />
                        </span>
                    </span>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pFrozenColumn style="min-width: 4rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>

                    <th
                        pSortableColumn="audit_history_uid"
                        style="min-width: 14rem"
                    >
                        AUDIT TEST HISTORY UID
                        <p-sortIcon field="audit_history_uid"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="audit_test_desc"
                        style="min-width: 14rem"
                    >
                        AUDIT TEST DESCRIPTION
                        <p-sortIcon field="audit_test_desc"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="au_level_4_desc"
                        style="min-width: 14rem"
                    >
                        AUDIT UNIVERESE LEVEL 4 DESCRIPTION
                        <p-sortIcon field="au_level_4_desc"></p-sortIcon>
                    </th>
                    <th pSortableColumn="audit_risk" style="min-width: 14rem">
                        RISK DESCRIPTION
                        <p-sortIcon field="audit_risk"></p-sortIcon>
                    </th>
                    <th pSortableColumn="control" style="min-width: 14rem">
                        CONTROL DESCRIPTION
                        <p-sortIcon field="control"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="script_defination"
                        style="min-width: 14rem"
                    >
                        SCRIPT DEFINATION
                        <p-sortIcon field="script_defination"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="script_presto"
                        style="min-width: 14rem"
                    >
                        FEDERATED SCRIPT
                        <p-sortIcon field="script_presto"></p-sortIcon>
                    </th>
                    <th pSortableColumn="script_sql" style="min-width: 14rem">
                        SQL SCRIPT
                        <p-sortIcon field="script_sql"></p-sortIcon>
                    </th>
                    <th pSortableColumn="target_table" style="min-width: 14rem">
                        TARGET TABLE<p-sortIcon
                            field="target_table"
                        ></p-sortIcon>
                    </th>
                    <th pSortableColumn="result" style="min-width: 14rem">
                        RESULT
                        <p-sortIcon field="result"></p-sortIcon>
                    </th>
                    <th pSortableColumn="notes" style="min-width: 14rem">
                        NOTES
                        <p-sortIcon field="notes"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_status"
                        style="min-width: 14rem"
                    >
                        SCHEDULE STATUS
                        <p-sortIcon field="schedule_status"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_start_datetime"
                        style="min-width: 14rem"
                    >
                        SCHEDULE START DATE
                        <p-sortIcon
                            field="schedule_start_datetime"
                        ></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="schedule_run_time"
                        style="min-width: 14rem"
                    >
                        SCHEDULE START TIME
                        <p-sortIcon field="schedule_run_time"></p-sortIcon>
                    </th>
                    <th pSortableColumn="created_date" style="min-width: 14rem">
                        CREATED DATE
                        <p-sortIcon field="created_date"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="job_run_status_text"
                        style="min-width: 14rem"
                    >
                        JOB RUN STATUS
                        <p-sortIcon field="job_run_status_text"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="error_message"
                        style="min-width: 14rem"
                    >
                        ERROR DESCRIPTION
                        <p-sortIcon field="error_message"></p-sortIcon>
                    </th>
                    <th
                        pSortableColumn="audit_run_status_text"
                        style="min-width: 14rem"
                    >
                        AUDIT RUN STATUS
                        <p-sortIcon field="audit_run_status_text"></p-sortIcon>
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
                <tr class="p-selectable-row">
                    <td pFrozenColumn class="text-base" style="max-width: 4rem">
                        <p-tableCheckbox
                            [value]="item"
                            (click)="editHistroy(item)"
                        ></p-tableCheckbox>
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_history_uid }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_test_desc.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.au_level_4_desc }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.audit_risk.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.control.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_defination }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_presto.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.script_sql.substring(0, 30) }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.target_table }}
                    </td>
                    <td class="text-base" style="min-width: 14rem">
                        {{ item.results ? item.results : 'N/A' }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.notes }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.schedule_status }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.schedule_start_datetime | date }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ getTwoDigit(item.schedule_run_time) }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.created_date | date : 'medium' }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.job_run_status_text | titlecase }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.error_message | titlecase }}
                    </td>
                    <td class="text-base" style="min-width: 12rem">
                        {{ item.audit_run_status_text | titlecase }}
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <br />
        <div
            *ngIf="
                auditTHSelection?.length == 1 &&
                auditTSelection?.length > 0 &&
                auditPSelection?.length > 0 &&
                auditTHSelection[0].job_run_status == 5
            "
            class="mt-2"
        >
            <form
                *ngIf="auditTestHistoryForm"
                [formGroup]="auditTestHistoryForm"
                (ngSubmit)="saveTestHistory()"
            >
                <div
                    *ngIf="auditTestHistoryForm.value.results; else resultError"
                >
                    <div class="grid">
                        <div class="col-8 align-self-center">
                            <div class="grid">
                                <div class="col align-self-center">
                                    <div
                                        class="border-1 border-round-lg p-3 text-center"
                                    >
                                        <strong
                                            >Audit Universe Level 4 :
                                        </strong>
                                        <span>{{
                                            auditTHSelection[0].au_level_4_desc
                                        }}</span>
                                    </div>
                                    <div
                                        class="border-1 border-round-lg p-3 text-center mt-1"
                                    >
                                        <strong>Risk : </strong>
                                        <span
                                            >{{ auditTHSelection[0].risk_uid }}
                                            -
                                            {{
                                                auditTHSelection[0].audit_risk
                                            }}</span
                                        >
                                    </div>
                                    <div
                                        class="border-1 border-round-lg p-3 text-center mt-1"
                                    >
                                        <strong>Store : </strong>
                                        <span>{{
                                            auditTHSelection[0].store
                                        }}</span>
                                    </div>
                                </div>
                                <div class="col align-self-center">
                                    <div class="field">
                                        <div class="hexagon-wrapper">
                                            <button
                                                class="hexagon"
                                                type="button"
                                                (click)="
                                                    changeHistoryStatus(
                                                        auditTestHistoryForm
                                                            .value.results
                                                    )
                                                "
                                            >
                                                <span>{{
                                                    auditTestHistoryForm.value
                                                        .results == null
                                                        ? ''
                                                        : auditTestHistoryForm
                                                              .value.results
                                                }}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col align-self-center">
                                    <div
                                        class="border-1 border-round-lg p-3 text-center"
                                    >
                                        <strong>Control : </strong>
                                        <span
                                            >{{
                                                auditTHSelection[0].control_uid
                                            }}
                                            -
                                            {{ auditTHSelection[0].control }}
                                        </span>
                                    </div>
                                    <div
                                        class="border-1 border-round-lg p-3 text-center mt-1"
                                    >
                                        <strong>Script : </strong>
                                        <span
                                            >{{
                                                auditTHSelection[0].script_uid
                                            }}
                                            -
                                            {{
                                                auditTHSelection[0]
                                                    .script_defination
                                            }}
                                        </span>
                                    </div>
                                    <div
                                        class="border-1 border-round-lg p-3 text-center mt-1"
                                    >
                                        <strong>Run Date : </strong>
                                        <span>{{
                                            auditTHSelection[0].run_datetime
                                                | date
                                        }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4 align-self-center">
                            <div class="field">
                                <div class="mb-2">
                                    <label for="notes">Note</label>
                                </div>
                                <textarea
                                    rows="5"
                                    cols="40"
                                    id="notes"
                                    pInputText
                                    formControlName="notes"
                                >
                                </textarea>
                            </div>
                            <div>
                                <button
                                    pButton
                                    pRipple
                                    label="Save"
                                    #submitButtonaudith
                                    icon="pi pi-check"
                                    class="p-button-primary"
                                    type="submit"
                                ></button>
                                &nbsp;
                                <p-button
                                    label="Cancel"
                                    icon="pi pi-times"
                                    styleClass="p-button-secondary"
                                    (click)="auditTHSelection = []"
                                ></p-button
                                >&nbsp;
                                <p-button
                                    type="button"
                                    styleClass="p-button-primary"
                                    (click)="viewResults()"
                                >
                                    <span class="p-button-label"
                                        >View Data Results</span
                                    ><span
                                        class="p-ink"
                                        style="
                                            height: 64px;
                                            width: 64px;
                                            top: -9.25px;
                                            left: -6.32812px;
                                        "
                                    ></span>
                                </p-button>
                            </div>
                        </div>
                    </div>
                </div>
                <ng-template #resultError>
                    <div
                        class="flex align-items-center justify-content-center w-3"
                    >
                        <div>
                            <strong class="text-4xl">Error: </strong>
                            <br />
                            <div>Error in executing Script</div>
                        </div>
                    </div>
                </ng-template>
            </form>
        </div>

        <div
            *ngIf="
                auditTHSelection?.length == 1 &&
                auditTSelection?.length > 0 &&
                auditPSelection?.length > 0 &&
                auditTHSelection[0].job_run_status != 5
            "
            class="mt-2 text-center"
        >
            Job is {{ auditTHSelection[0].job_run_status_text }}
        </div>
    </div>

    <p-dialog
        [(visible)]="auditProgramDialog"
        [style]="{ width: '900px' }"
        header="Audit Program Details"
        [modal]="true"
        class="p-fluid"
    >
        <ng-template pTemplate="content">
            <form [formGroup]="auditProgramForm">
                <div class="grid formgrid">
                    <div class="col-12 mb-2 p-dialog-content">
                        <div class="field">
                            <label for="ap_name">AP NAME <sup>*</sup></label>
                            <input
                                id="ap_name"
                                pInputText
                                formControlName="ap_name"
                            />
                        </div>
                    </div>
                    <div class="col-12 mb-2 lg:col-6 lg:mb-0 p-dialog-content">
                        <div class="field">
                            <label for="ap_desc"
                                >AP Description <sup>*</sup></label
                            >
                            <input
                                id="ap_desc"
                                pInputText
                                formControlName="ap_desc"
                                (click)="
                                    getText(
                                        auditProgramForm.get('ap_desc').value,
                                        auditProgramForm,
                                        'ap_desc',
                                        'AP Description'
                                    )
                                "
                            />
                        </div>
                        <div class="field">
                            <label for="frequency"
                                >Frequency <sup class="opacity-0">*</sup></label
                            >
                            <p-dropdown
                                appendTo="body"
                                id="frequency"
                                class="p-inputwrapper"
                                [options]="filteredFrequency"
                                formControlName="frequency_id"
                                placeholder="Select a frequency"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>
                        <div class="field">
                            <label for="ap_schedule_date"
                                >AP Schedule Start Date
                                <sup
                                    [class.opacity-0]="
                                        auditProgramForm.get('frequency_id')
                                            .value == null
                                    "
                                    >*</sup
                                ></label
                            >
                            <p-calendar
                                appendTo="body"
                                id="ap_schedule_date"
                                [showIcon]="true"
                                [showButtonBar]="true"
                                formControlName="ap_schedule_date"
                                [minDate]="today"
                            ></p-calendar>
                        </div>
                    </div>
                    <div class="col-12 mb-2 lg:col-6 lg:mb-0 p-dialog-content">
                        <div class="field">
                            <label for="au_level_3_id"
                                >Audit Universe ID (Level 3) <sup>*</sup></label
                            >
                            <p-autoComplete
                                appendTo="body"
                                placeholder="Search"
                                [dropdown]="true"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                [multiple]="false"
                                [suggestions]="filteredAuditUniverse3"
                                (completeMethod)="filterAuditUniverse3($event)"
                                formControlName="au_level_3_id"
                                [disabled]="auditT?.length > 0 && isAUEdit"
                            ></p-autoComplete>
                            <small
                                *ngIf="filteredAuditUniverse3?.length == 0"
                                class="p-error"
                                >No Records Found</small
                            >
                        </div>
                        <div class="field">
                            <label for="ap_schedule_time"
                                >AP Schedule Time
                                <sup
                                    [class.opacity-0]="
                                        auditProgramForm.get('frequency_id')
                                            .value == null
                                    "
                                    >*</sup
                                >
                            </label>
                            <p-dropdown
                                appendTo="body"
                                id="ap_schedule_time"
                                [options]="time"
                                optionLabel="name"
                                optionValue="code"
                                formControlName="ap_schedule_time"
                            ></p-dropdown>
                        </div>
                        <div class="field">
                            <label for="next_run"
                                >AP Schedule End Date
                                <sup
                                    [class.opacity-0]="
                                        auditProgramForm.get('frequency_id')
                                            .value == null
                                    "
                                    >*</sup
                                ></label
                            >
                            <p-calendar
                                appendTo="body"
                                id="next_run"
                                [showIcon]="true"
                                [showButtonBar]="true"
                                formControlName="next_run"
                                [minDate]="
                                    auditProgramForm.get('ap_schedule_date')
                                        .value
                                "
                            ></p-calendar>
                        </div>
                    </div>
                </div>
            </form>
        </ng-template>

        <ng-template pTemplate="footer">
            <p-button
                label="Cancel"
                icon="pi pi-times"
                styleClass="p-button-secondary"
                (click)="auditProgramDialog = false"
            ></p-button>
            <button
                pButton
                pRipple
                #submitButton
                label="Save"
                icon="pi pi-check"
                styleClass="p-button-primary"
                (click)="saveAudit()"
                [disabled]="auditProgramForm.invalid"
            ></button>
        </ng-template>
    </p-dialog>

    <p-dialog
        [(visible)]="auditTestDialog"
        [style]="{ width: '89%', height: '89%' }"
        header="Audit Test Details"
        [modal]="true"
        class="p-fluid"
    >
        <ng-template pTemplate="content">
            <form [formGroup]="auditTestForm">
                <div class="grid">
                    <div class="col">
                        <div class="col">
                            <div class="grid">
                                <div class="col align-self-center">
                                    <div class="field">
                                        <label for="audit_test_desc"
                                            >Audit Test Description
                                            <sup>*</sup></label
                                        >
                                        <input
                                            id="audit_test_desc"
                                            pInputText
                                            formControlName="audit_test_desc"
                                            (click)="
                                                getText(
                                                    auditTestForm.get(
                                                        'audit_test_desc'
                                                    ).value,
                                                    auditTestForm,
                                                    'audit_test_desc',
                                                    'Audit Test Description'
                                                )
                                            "
                                        />
                                    </div>
                                </div>
                                <div style="width: 205px !important"></div>
                                <div class="col align-self-center">
                                    <div class="field">
                                        <label for="au_id"
                                            >Department<sup>*</sup></label
                                        >
                                        <p-autoComplete
                                            appendTo="body"
                                            placeholder="Search"
                                            [dropdown]="true"
                                            [multiple]="false"
                                            [suggestions]="filteredBanner"
                                            (completeMethod)="
                                                filterBanner($event)
                                            "
                                            formControlName="banner_id"
                                            [disabled]="auditTestMode == 'edit'"
                                        ></p-autoComplete>
                                    </div>
                                </div>
                            </div>
                            <div class="grid">
                                <div class="col align-self-center">
                                    <div class="field">
                                        <label for="au_id"
                                            >Audit Universe L4
                                            <sup>*</sup></label
                                        >
                                        <p-autoComplete
                                            appendTo="body"
                                            placeholder="Search"
                                            [dropdown]="true"
                                            [showTransitionOptions]="'0ms'"
                                            [hideTransitionOptions]="'0ms'"
                                            [multiple]="false"
                                            [suggestions]="
                                                filteredAuditUniverse4
                                            "
                                            (completeMethod)="
                                                filterAuditUniverse4($event)
                                            "
                                            formControlName="au_level_4_id"
                                            (onSelect)="
                                                onAuditUniverse4Select($event);
                                                isRiskEnable = false
                                            "
                                            [autoHighlight]="true"
                                            [forceSelection]="true"
                                            [completeOnFocus]="true"
                                        ></p-autoComplete>
                                        <small
                                            *ngIf="auditUniverse4?.length == 0"
                                            class="p-error"
                                            >No scripts found with related Audit
                                            program AU Level 3</small
                                        >
                                    </div>
                                    <div class="field">
                                        <label for="au_id"
                                            >Risk <sup>*</sup></label
                                        >
                                        <p-progressSpinner
                                            *ngIf="loadingRisk"
                                            [style]="{
                                                width: '40px',
                                                height: '40px'
                                            }"
                                            styleClass="custom-spinner"
                                            strokeWidth="8"
                                            animationDuration=".5s"
                                        ></p-progressSpinner>
                                        <p-autoComplete
                                            *ngIf="!loadingRisk"
                                            placeholder="Search"
                                            [dropdown]="true"
                                            [showTransitionOptions]="'0ms'"
                                            [hideTransitionOptions]="'0ms'"
                                            [multiple]="false"
                                            [suggestions]="filteredRisk"
                                            (completeMethod)="
                                                filterRisk($event)
                                            "
                                            formControlName="risk_id"
                                            [disabled]="isRiskEnable"
                                            (onSelect)="
                                                onRiskSelect($event);
                                                isControlEnable = false
                                            "
                                        ></p-autoComplete>
                                        <span *ngIf="!isRiskEnable">
                                            <small
                                                *ngIf="riskd?.length == 0"
                                                class="p-error"
                                                >No Risk Found</small
                                            >
                                        </span>
                                    </div>
                                </div>
                                <div class="hexagon-wrapper">
                                    <button
                                        #submitButtonaudit
                                        class="hexagon"
                                        (click)="saveAuditTest()"
                                        [disabled]="auditTestForm.invalid"
                                    >
                                        <span>Save Audit Test</span>
                                    </button>
                                </div>
                                <div class="col align-self-center">
                                    <div class="field">
                                        <label for="au_id"
                                            >Control <sup>*</sup></label
                                        >
                                        <p-progressSpinner
                                            *ngIf="loadingControl"
                                            [style]="{
                                                width: '40px',
                                                height: '40px'
                                            }"
                                            styleClass="custom-spinner"
                                            strokeWidth="8"
                                            animationDuration=".5s"
                                        ></p-progressSpinner>
                                        <p-autoComplete
                                            *ngIf="!loadingControl"
                                            placeholder="Search"
                                            [showTransitionOptions]="'0ms'"
                                            [hideTransitionOptions]="'0ms'"
                                            [dropdown]="true"
                                            [multiple]="false"
                                            [suggestions]="filteredControl"
                                            (completeMethod)="
                                                filterControl($event)
                                            "
                                            formControlName="control_id"
                                            [disabled]="isControlEnable"
                                            (onSelect)="
                                                onControlSelect($event);
                                                isScriptEnable = false
                                            "
                                        ></p-autoComplete>
                                        <span *ngIf="!isControlEnable">
                                            <small
                                                *ngIf="controld?.length == 0"
                                                class="p-error"
                                                >No Control Found</small
                                            >
                                        </span>
                                    </div>
                                    <div class="field">
                                        <label for="au_id"
                                            >Script <sup>*</sup></label
                                        >
                                        <p-progressSpinner
                                            *ngIf="loadingScript"
                                            [style]="{
                                                width: '40px',
                                                height: '40px'
                                            }"
                                            styleClass="custom-spinner"
                                            strokeWidth="8"
                                            animationDuration=".5s"
                                        ></p-progressSpinner>
                                        <p-autoComplete
                                            *ngIf="!loadingScript"
                                            appendTo="body"
                                            placeholder="Search"
                                            [showTransitionOptions]="'0ms'"
                                            [hideTransitionOptions]="'0ms'"
                                            [dropdown]="true"
                                            [multiple]="false"
                                            [suggestions]="filteredScript"
                                            (completeMethod)="
                                                filterScript($event)
                                            "
                                            formControlName="script_id"
                                            (onSelect)="onSelectScript($event)"
                                            [disabled]="isScriptEnable"
                                        ></p-autoComplete>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="noScript" class="text-center text-xl">
                                <span class="text-pink-500"
                                    >There are no active scripts for this
                                    combination</span
                                >
                            </div>
                        </div>
                        <div>
                            <table class="selectedVal">
                                <tr>
                                    <td
                                        class="text-base"
                                        style="width: 20% !important"
                                    >
                                        Audit Universe L4
                                    </td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.auditTestForm.get(
                                                    'au_level_4_id'
                                                ).value,
                                                'Audit Universe L4'
                                            )
                                        "
                                    >
                                        {{
                                            this.auditTestForm.get(
                                                'au_level_4_id'
                                            ).value
                                        }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Risk Description</td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.auditTestForm.get(
                                                    'risk_id'
                                                ).value,
                                                'Risk'
                                            )
                                        "
                                    >
                                        {{
                                            this.auditTestForm.get('risk_id')
                                                .value
                                        }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Control Description</td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.auditTestForm.get(
                                                    'control_id'
                                                ).value,
                                                'Control'
                                            )
                                        "
                                    >
                                        {{
                                            this.auditTestForm.get('control_id')
                                                .value
                                        }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Script Description</td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.auditTestForm.get(
                                                    'script_id'
                                                ).value,
                                                'Script'
                                            )
                                        "
                                    >
                                        {{
                                            this.auditTestForm.get('script_id')
                                                .value
                                        }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Presto Script</td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.scriptSelection
                                                    .script_presto,
                                                'Presto Script'
                                            )
                                        "
                                    >
                                        <div *ngIf="scriptSelection">
                                            {{
                                                this.scriptSelection
                                                    .script_presto
                                            }}
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>SQL Script</td>
                                    <td
                                        title="Click to view full detail"
                                        style="
                                            width: 70% !important;

                                            white-space: nowrap;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                        "
                                        (click)="
                                            showScript(
                                                this.scriptSelection.script_sql,
                                                'SQL Script'
                                            )
                                        "
                                    >
                                        <div *ngIf="scriptSelection">
                                            {{
                                                this.scriptSelection.script_sql
                                            }}
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <br />
                        <div
                            style="display: table"
                            class="selectedVal"
                            *ngIf="scriptSelection && script?.length > 0"
                        >
                            <div *ngIf="scriptSelection">
                                <div
                                    formArrayName="scriptVariables"
                                    *ngFor="
                                        let item of auditTestForm.get(
                                            'scriptVariables'
                                        ).controls;
                                        let i = index
                                    "
                                >
                                    <div
                                        class="grid align-items-baseline"
                                        *ngIf="
                                            !scriptDefaultVariables.includes(
                                                scriptSelection.scriptVaribales[
                                                    i
                                                ].var_name
                                            )
                                        "
                                    >
                                        <div class="col font-bold">
                                            {{
                                                scriptSelection.scriptVaribales[
                                                    i
                                                ].var_name
                                            }}
                                        </div>
                                        <div class="col font-bold">
                                            {{
                                                scriptSelection.scriptVaribales[
                                                    i
                                                ].var_datatype
                                            }}
                                        </div>
                                        <div class="col" [formGroupName]="i">
                                            <div class="field">
                                                <input
                                                    pInputText
                                                    formControlName="var_value"
                                                    placeholder="Variable Value"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </ng-template>

        <ng-template pTemplate="footer">
            <p-button
                label="Cancel"
                icon="pi pi-times"
                styleClass="p-button-secondary"
                (click)="auditTestDialog = false"
            ></p-button>
        </ng-template>
    </p-dialog>

    <p-confirmDialog
        header="Confirmation"
        icon="pi pi-exclamation-triangle"
    ></p-confirmDialog>

    <p-dialog
        [(visible)]="graphDialog"
        [style]="{ width: '800px' }"
        header="Graph"
        [modal]="true"
        class="p-fluid"
    >
        <ng-template pTemplate="content">
            <div class="grid">
                <div class="col">
                    <p-chart
                        *ngIf="showGraph1; else noGraph1"
                        type="pie"
                        [data]="chartData1"
                        [options]="basicOptions"
                    ></p-chart>
                    <ng-template #noGraph1>
                        <div class="text-center text-4xl">No Graph</div>
                    </ng-template>
                    <div class="text-center m-2 text-2xl font-bold">
                        AP Level
                    </div>
                </div>
                <div class="col">
                    <p-chart
                        *ngIf="showGraph1; else noGraph2"
                        type="pie"
                        [data]="chartData2"
                        [options]="basicOptions"
                    ></p-chart>
                    <ng-template #noGraph2>
                        <div class="text-center text-4xl">No Graph</div>
                    </ng-template>
                    <div class="text-center m-2 text-2xl font-bold">
                        AT Level
                    </div>
                </div>
            </div>
        </ng-template>
    </p-dialog>
</div> -->

<p-toast></p-toast>

<p-tabView>
    <p-tabPanel header="Audit Program">
        <app-program
            [auditId]="auditId"
            (auditProgramSelection)="getProgram($event)"
        ></app-program>
    </p-tabPanel>
    <p-tabPanel
        [disabled]="
            selectedAuditProgram == null || selectedAuditProgram.length == 0
        "
        header="Audit Test"
    >
        <app-test
            [auditProgram]="selectedAuditProgram"
            (auditTestSelection)="getTest($event)"
        ></app-test>
    </p-tabPanel>
    <p-tabPanel
        [disabled]="selectedAuditTest == null || selectedAuditTest.length == 0"
        header="Audit Test History"
    >
        <app-test-history
            [auditTest]="selectedAuditTest"
            [auditProgram]="selectedAuditProgram"
            [audit]="audits"
        ></app-test-history>
    </p-tabPanel>
</p-tabView>
