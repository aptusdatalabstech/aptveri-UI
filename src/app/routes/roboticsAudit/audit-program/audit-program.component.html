<!-- <div class="grid">
    <div class="col-12">
        <div class="card">
            <p-toast></p-toast>
            <p-table
                *ngIf="audits"
                #dt1
                [value]="auditP"
                [rows]="5"
                [loading]="loadingP"
                [rowHover]="true"
                styleClass="p-datatable-gridlines"
                [paginator]="true"
                [rowsPerPageOptions]="[5, 10, 20]"
                [showCurrentPageReport]="true"
                [(selection)]="auditPSelection"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                responsiveLayout="scroll"
                [scrollable]="true"
            >
                <ng-template pTemplate="caption">
                    <div
                        class="flex flex-column md:flex-row md:align-items-center md:justify-content-between"
                    >
                        <h6 class="m-0">
                            AUDIT PROGRAM ({{ audits[0].audit_uid }} -
                            {{ audits[0].audit_name }})
                        </h6>
                        <div>
                            <button
                                type="button"
                                pButton
                                pRipple
                                icon="pi pi-arrow-left"
                                (click)="backClicked()"
                                class="p-button-rounded p-button-secondary"
                                title="Back"
                                tooltipPosition="left"
                            ></button
                            >&nbsp;
                            <button
                                *ngIf="
                                    accountSvr.checkPermission(4, 13, 'V') &&
                                    isButtonVisible
                                "
                                [disabled]="!auditPSelection?.length > 0"
                                title="Run Tests"
                                pButton
                                pRipple
                                icon="pi pi-play"
                                class="p-button-rounded p-button-purple-500"
                                (click)="runProgram()"
                            ></button>
                            <button
                                title="New"
                                pButton
                                pRipple
                                icon="pi pi-plus"
                                class="p-button-rounded p-button-success ml-2"
                                (click)="openP(null, 'new')"
                                *ngIf="
                                    accountSvr.checkPermission(4, 12, 'A') &&
                                    isButtonVisible
                                "
                            ></button>
                            <button
                                [disabled]="auditPSelection?.length != 1"
                                title="Edit"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning ml-2"
                                (click)="openP(auditPSelection[0], 'edit')"
                                *ngIf="
                                    accountSvr.checkPermission(4, 12, 'C') &&
                                    isButtonVisible
                                "
                            ></button>
                            <button
                                [disabled]="
                                    auditPSelection?.length != 1 ||
                                    auditT?.length != 0
                                "
                                title="Delete"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger ml-2"
                                (click)="deleteProgram(auditPSelection[0])"
                                *ngIf="
                                    accountSvr.checkPermission(4, 12, 'D') &&
                                    isButtonVisible
                                "
                            ></button>

                            <button
                                *ngIf="accountSvr.checkPermission(4, 13, 'V')"
                                [disabled]="!auditPSelection?.length > 0"
                                title="Show Graph"
                                pButton
                                pRipple
                                icon="pi pi-chart-pie"
                                class="p-button-rounded p-button-secondary ml-2"
                                (click)="getGraph()"
                            ></button>

                            <button
                                title="Clear"
                                pButton
                                pRipple
                                icon="pi pi-filter-slash"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="dt12.clear()"
                            ></button>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th pFrozenColumn style="max-width: 3rem">
                            <p-tableHeaderCheckbox
                                (click)="getTests()"
                            ></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="" style="max-width: 7rem">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                SCHEDULE
                            </div>
                        </th>
                        <th pSortableColumn="audit_program_uid">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="audit_program_uid"
                                ></p-sortIcon>
                                AP UID
                                <p-columnFilter
                                    type="text"
                                    field="audit_program_uid"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="ap_name">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="ap_name"></p-sortIcon>
                                AP NAME
                                <p-columnFilter
                                    type="text"
                                    field="ap_name"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="ap_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="ap_desc"></p-sortIcon>
                                AUDIT DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="ap_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="au_level_3_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="au_level_3_desc"
                                ></p-sortIcon>
                                AU DESCRIPTION (LEVEL 3)
                                <p-columnFilter
                                    type="text"
                                    field="au_level_3_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="ap_schedule_date">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="ap_schedule_date"
                                ></p-sortIcon>
                                AP SCHEDULE START DATE
                                <p-columnFilter
                                    type="text"
                                    field="ap_schedule_date"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="next_run">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="next_run"></p-sortIcon>
                                AP SCHEDULE END DATE
                                <p-columnFilter
                                    type="text"
                                    field="next_run"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="frequency_id">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="frequency_id"></p-sortIcon>
                                FREQUENCY
                                <p-columnFilter
                                    type="text"
                                    field="frequency_id"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="ap_schedule_time">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="ap_schedule_time"
                                ></p-sortIcon>
                                AP SCHEDULE TIME (HH24)
                                <p-columnFilter
                                    type="text"
                                    field="ap_schedule_time"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="full_name">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="full_name"></p-sortIcon>
                                CREATED BY
                                <p-columnFilter
                                    type="text"
                                    field="full_name"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template
                    pTemplate="body"
                    let-auditP
                    *ngIf="accountSvr.checkPermission(4, 12, 'V')"
                >
                    <tr>
                        <td pFrozenColumn style="max-width: 3rem">
                            <p-tableCheckbox
                                [value]="auditP"
                                (click)="selectRow(auditP)"
                            ></p-tableCheckbox>
                        </td>
                        <td style="max-width: 7rem; min-width: 7rem">
                            <p-inputSwitch
                                *ngIf="auditP.frequency_id > 0"
                                (onChange)="changeStatus(auditP, $event)"
                                [(ngModel)]="auditP.schedule_enable"
                            ></p-inputSwitch>
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.audit_program_uid }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.ap_name }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.ap_desc }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.au_level_3_desc }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.ap_schedule_date | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.next_run | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ getFrequency(auditP.frequency_id) }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ getTwoDigit(auditP.ap_schedule_time) }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditP.full_name }}
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6">No Audit Program found.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="6">
                            Loading Audit Program data. Please wait.
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <p-table
                *ngIf="auditPSelection?.length"
                #dt2
                [value]="auditT"
                [rows]="5"
                [loading]="loadingT"
                [rowHover]="true"
                styleClass="p-datatable-gridlines"
                [paginator]="true"
                [rowsPerPageOptions]="[5, 10, 20]"
                [showCurrentPageReport]="true"
                [(selection)]="auditTSelection"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                responsiveLayout="scroll"
                [scrollable]="true"
            >
                <ng-template pTemplate="caption">
                    <div
                        class="flex flex-column md:flex-row md:align-items-center md:justify-content-between"
                    >
                        <h6 class="m-0">AUDIT TESTS</h6>
                        <div>
                            <button
                                *ngIf="
                                    accountSvr.checkPermission(4, 13, 'V') &&
                                    isButtonVisible
                                "
                                [disabled]="!auditTSelection?.length > 0"
                                title="Run Test"
                                pButton
                                pRipple
                                icon="pi pi-play"
                                class="p-button-rounded p-button-purple-500"
                                (click)="runTest(auditTSelection)"
                            ></button>
                            <button
                                title="New"
                                pButton
                                pRipple
                                icon="pi pi-plus"
                                class="p-button-rounded p-button-success ml-2"
                                (click)="openT(null, 'new')"
                                [disabled]="auditPSelection?.length != 1"
                                *ngIf="
                                    accountSvr.checkPermission(4, 13, 'A') &&
                                    isButtonVisible
                                "
                            ></button>
                            <button
                                [disabled]="
                                    auditTSelection?.length != 1 ||
                                    auditTH?.length != 0
                                "
                                title="Edit"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning ml-2"
                                (click)="openT(auditTSelection[0], 'edit')"
                                *ngIf="
                                    accountSvr.checkPermission(4, 13, 'C') &&
                                    isButtonVisible
                                "
                            ></button>
                            <button
                                [disabled]="
                                    auditTSelection?.length != 1 ||
                                    auditTH?.length != 0
                                "
                                title="Delete"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger ml-2"
                                (click)="deleteTest(auditTSelection[0])"
                                *ngIf="
                                    accountSvr.checkPermission(4, 13, 'D') &&
                                    isButtonVisible
                                "
                            ></button>
                            <button
                                title="Clear"
                                pButton
                                pRipple
                                icon="pi pi-filter-slash"
                                class="p-button-rounded p-button-info ml-2"
                                (click)="dt2.clear()"
                            ></button>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th pFrozenColumn style="max-width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="audit_test_uid">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="audit_test_uid"></p-sortIcon>
                                AUDIT TEST UID
                                <p-columnFilter
                                    type="text"
                                    field="audit_test_uid"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="audit_test_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="audit_test_desc"
                                ></p-sortIcon>
                                AUDIT TEST DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="audit_test_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="au_level_4_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="au_level_4_desc"
                                ></p-sortIcon>
                                AUDIT UNIVERSE LEVEL 4
                                <p-columnFilter
                                    type="text"
                                    field="au_level_4_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="audit_risk">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="audit_risk"></p-sortIcon>
                                RISK DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="audit_risk"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="control">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="control"></p-sortIcon>
                                CONTROL DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="control"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="banner">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="banner"></p-sortIcon>
                                BANNER DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="banner"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="target_table">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="target_table"></p-sortIcon>
                                TARGET TABLE
                                <p-columnFilter
                                    type="text"
                                    field="target_table"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_defination">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="script_defination"
                                ></p-sortIcon>
                                SCRIPT DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="script_defination"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_presto">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="script_presto"></p-sortIcon>
                                PRESTO SCRIPT
                                <p-columnFilter
                                    type="text"
                                    field="script_presto"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_sql">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="script_sql"></p-sortIcon>
                                SQL SCRIPT
                                <p-columnFilter
                                    type="text"
                                    field="script_sql"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="result">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="result"></p-sortIcon>
                                RESULTS
                                <p-columnFilter
                                    type="text"
                                    field="result"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="notes">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="notes"></p-sortIcon>
                                NOTES
                                <p-columnFilter
                                    type="text"
                                    field="notes"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_status">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_status"
                                ></p-sortIcon>
                                SCHEDULE STATUS
                                <p-columnFilter
                                    type="text"
                                    field="schedule_status"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_start_datetime">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_start_datetime"
                                ></p-sortIcon>
                                SCHEDULE START DATE
                                <p-columnFilter
                                    type="text"
                                    field="schedule_start_datetime"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_end_datetime">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_end_datetime"
                                ></p-sortIcon>
                                SCHEDULE END DATE
                                <p-columnFilter
                                    type="text"
                                    field="schedule_end_datetime"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="last_run_date">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="last_run_date"></p-sortIcon>
                                LAST RUN DATE
                                <p-columnFilter
                                    type="text"
                                    field="last_run_date"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="full_name">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="full_name"></p-sortIcon>
                                CREATED BY
                                <p-columnFilter
                                    type="text"
                                    field="full_name"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template
                    pTemplate="body"
                    let-auditT
                    *ngIf="accountSvr.checkPermission(4, 13, 'V')"
                >
                    <tr>
                        <td pFrozenColumn style="max-width: 3rem">
                            <p-tableCheckbox
                                [value]="auditT"
                                (click)="selectTest(auditT)"
                            ></p-tableCheckbox>
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.audit_test_uid }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.audit_test_desc,
                                    'Audit Test Description'
                                )
                            "
                        >
                            {{ auditT.audit_test_desc }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.au_level_4_desc }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.audit_risk,
                                    'Risk Description'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.audit_risk }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.control,
                                    'Control Description'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.control }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.banner }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.target_table }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.script_defination }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.script_presto,
                                    'Presto SCRIPT'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.script_presto }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(auditT.script_sql, 'SQL SCRIPT')
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.script_sql }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.results ? auditT.results : 'N/A' }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.notes }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.schedule_status }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.schedule_start_datetime | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.schedule_end_datetime | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.last_run_date | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.full_name }}
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6">No Audit Tests found.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="6">
                            Loading Audit Tests data. Please wait.
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <p-table
                *ngIf="
                    auditTSelection?.length > 0 && auditPSelection?.length > 0
                "
                #dt3
                [value]="auditTH"
                [rows]="5"
                [loading]="loadingTH"
                [rowHover]="true"
                styleClass="p-datatable-gridlines"
                [paginator]="true"
                [rowsPerPageOptions]="[5, 10, 20]"
                [showCurrentPageReport]="true"
                (onRowSelect)="selecthistory()"
                (onRowUnselect)="selecthistory()"
                [(selection)]="auditTHSelection"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                responsiveLayout="scroll"
                [scrollable]="true"
            >
                <ng-template pTemplate="caption">
                    <div
                        class="flex flex-column md:flex-row md:align-items-center md:justify-content-between"
                    >
                        <h6 class="m-0">AUDIT TESTS HISTORY</h6>
                        <div>
                            <button
                                title="Refresh"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-refresh"
                                class="p-button-rounded p-button-secondary ml-2"
                                (click)="refreshHistory()"
                            ></button>
                            &nbsp;
                            <button
                                title="Download Excel"
                                pButton
                                pRipple
                                icon="pi pi-file-excel"
                                class="p-button-rounded p-button-purple-500"
                                [disabled]="auditTHSelection?.length < 1"
                                (click)="downloadExcel()"
                            ></button>

                            <button
                                *ngIf="accountSvr.checkPermission(4, 13, 'D')"
                                [disabled]="auditTHSelection?.length != 1"
                                title="Delete"
                                pButton
                                pRipple
                                type="button"
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger ml-2"
                                (click)="
                                    deleteAuditHistroy(auditTHSelection[0])
                                "
                            ></button>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th pFrozenColumn style="max-width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="audit_history_uid">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="audit_history_uid"
                                ></p-sortIcon>
                                AUDIT TEST HISTORY UID
                                <p-columnFilter
                                    type="text"
                                    field="audit_history_uid"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>

                        <th pSortableColumn="audit_test_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="audit_test_desc"
                                ></p-sortIcon>
                                AUDIT TEST DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="audit_test_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>

                        <th pSortableColumn="au_level_4_desc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="au_level_4_desc"
                                ></p-sortIcon>
                                AUDIT UNIVERSE LEVEL 4
                                <p-columnFilter
                                    type="text"
                                    field="au_level_4_desc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="audit_risk">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="audit_risk"></p-sortIcon>
                                RISK DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="audit_risk"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="control">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="control"></p-sortIcon>
                                CONTROL DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="control"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_defination">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="script_defination"
                                ></p-sortIcon>
                                SCRIPT DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="script_defination"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_presto">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="script_presto"></p-sortIcon>
                                PRESTO SCRIPT
                                <p-columnFilter
                                    type="text"
                                    field="script_presto"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="script_sql">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="script_sql"></p-sortIcon>
                                SQL SCRIPT
                                <p-columnFilter
                                    type="text"
                                    field="script_sql"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="target_table">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="target_table"></p-sortIcon>
                                TARGET TABLE
                                <p-columnFilter
                                    type="text"
                                    field="target_table"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="results">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="results"></p-sortIcon>
                                RESULTS
                                <p-columnFilter
                                    type="text"
                                    field="results"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="notes">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="notes"></p-sortIcon>
                                NOTES
                                <p-columnFilter
                                    type="text"
                                    field="notes"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_status">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_status"
                                ></p-sortIcon>
                                SCHEDULE STATUS
                                <p-columnFilter
                                    type="text"
                                    field="schedule_status"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_start_datetime">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_start_datetime"
                                ></p-sortIcon>
                                SCHEDULE START DATE
                                <p-columnFilter
                                    type="text"
                                    field="schedule_start_datetime"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="schedule_run_time">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="schedule_run_time"
                                ></p-sortIcon>
                                SCHEDULE START TIME (HH24)
                                <p-columnFilter
                                    type="text"
                                    field="schedule_run_time"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="created_date">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="created_date"></p-sortIcon>
                                CREATED ON
                                <p-columnFilter
                                    type="text"
                                    field="created_date"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="job_run_status_text">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="job_run_status_text"
                                ></p-sortIcon>
                                JOB RUN STATUS
                                <p-columnFilter
                                    type="text"
                                    field="job_run_status_text"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="error_message">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="error_message"></p-sortIcon>
                                ERROR MESSAGE
                                <p-columnFilter
                                    type="text"
                                    field="error_message"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="audit_run_status_text">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="audit_run_status_text"
                                ></p-sortIcon>
                                AUDIT RUN STATUS
                                <p-columnFilter
                                    type="text"
                                    field="audit_run_status_text"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-auditT>
                    <tr>
                        <td pFrozenColumn style="max-width: 3rem">
                            <p-tableCheckbox
                                [value]="auditT"
                                (click)="editHistroy(auditT)"
                            ></p-tableCheckbox>
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.audit_history_uid }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.audit_test_desc,
                                    'Audit Test Description'
                                )
                            "
                        >
                            {{ auditT.audit_test_desc }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.au_level_4_desc }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.audit_risk,
                                    'Risk Description'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.audit_risk }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.control,
                                    'Control Description'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.control }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.script_defination }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(
                                    auditT.script_presto,
                                    'Presto Script'
                                )
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.script_presto }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="truncate cursor-pointer"
                            (click)="
                                showScript(auditT.script_sql, 'SQL Script')
                            "
                            title="Click to view full detail"
                        >
                            {{ auditT.script_sql }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.target_table }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.results ? auditT.results : 'N/A' }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.notes }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.schedule_status }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.schedule_start_datetime | date }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ getTwoDigit(auditT.schedule_run_time) }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.created_date | date : 'medium' }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.job_run_status_text | titlecase }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.error_message | titlecase }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ auditT.audit_run_status_text | titlecase }}
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6">No results available for this test.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="6">
                            Loading Audit Tests data. Please wait.
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <p-dialog
                [(visible)]="auditProgramDialog"
                [style]="{ width: '900px' }"
                header="Audit Program Details"
                [modal]="true"
                class="p-fluid"
            >
                <ng-template pTemplate="content">
                    <form [formGroup]="auditProgramForm">
                        <div class="grid formgrid">
                            <div class="col-12 mb-2 p-dialog-content">
                                <div class="field">
                                    <label for="ap_name"
                                        >AP NAME <sup>*</sup></label
                                    >
                                    <input
                                        id="ap_name"
                                        pInputText
                                        formControlName="ap_name"
                                    />
                                </div>
                            </div>
                            <div
                                class="col-12 mb-2 lg:col-6 lg:mb-0 p-dialog-content"
                            >
                                <div class="field">
                                    <label for="ap_desc"
                                        >AP Description <sup>*</sup></label
                                    >
                                    <input
                                        id="ap_desc"
                                        pInputText
                                        formControlName="ap_desc"
                                        (click)="
                                            getText(
                                                auditProgramForm.get('ap_desc')
                                                    .value,
                                                auditProgramForm,
                                                'ap_desc',
                                                'AP Description'
                                            )
                                        "
                                    />
                                </div>
                                <div class="field">
                                    <label for="frequency"
                                        >Frequency
                                        <sup class="opacity-0">*</sup></label
                                    >
                                    <p-dropdown
                                        appendTo="body"
                                        id="frequency"
                                        class="p-inputwrapper"
                                        [options]="filteredFrequency"
                                        formControlName="frequency_id"
                                        placeholder="Select a frequency"
                                        [showClear]="true"
                                    ></p-dropdown>
                                </div>
                                <div class="field">
                                    <label for="ap_schedule_date"
                                        >AP Schedule Start Date
                                        <sup
                                            [class.opacity-0]="
                                                auditProgramForm.get(
                                                    'frequency_id'
                                                ).value == null
                                            "
                                            >*</sup
                                        ></label
                                    >
                                    <p-calendar
                                        appendTo="body"
                                        id="ap_schedule_date"
                                        [showIcon]="true"
                                        [showButtonBar]="true"
                                        formControlName="ap_schedule_date"
                                        [minDate]="today"
                                    ></p-calendar>
                                </div>
                            </div>
                            <div
                                class="col-12 mb-2 lg:col-6 lg:mb-0 p-dialog-content"
                            >
                                <div class="field">
                                    <label for="au_level_3_id"
                                        >AU ID (Level 3) <sup>*</sup></label
                                    >
                                    <p-autoComplete
                                        appendTo="body"
                                        placeholder="Search"
                                        [dropdown]="true"
                                        [autoHighlight]="true"
                                        [forceSelection]="true"
                                        [completeOnFocus]="true"
                                        [minLength]="1"
                                        [multiple]="false"
                                        [suggestions]="filteredAuditUniverse3"
                                        (completeMethod)="
                                            filterAuditUniverse3($event)
                                        "
                                        formControlName="au_level_3_id"
                                        [disabled]="
                                            auditT?.length > 0 && isAUEdit
                                        "
                                    ></p-autoComplete>
                                    <small
                                        *ngIf="
                                            filteredAuditUniverse3?.length == 0
                                        "
                                        class="p-error"
                                        >No Records Found</small
                                    >
                                </div>
                                <div class="field">
                                    <label for="ap_schedule_time"
                                        >AP Schedule Time
                                        <sup
                                            [class.opacity-0]="
                                                auditProgramForm.get(
                                                    'frequency_id'
                                                ).value == null
                                            "
                                            >*</sup
                                        >
                                    </label>
                                    <p-dropdown
                                        appendTo="body"
                                        id="ap_schedule_time"
                                        [options]="time"
                                        optionLabel="name"
                                        optionValue="code"
                                        formControlName="ap_schedule_time"
                                    ></p-dropdown>
                                </div>
                                <div class="field">
                                    <label for="next_run"
                                        >AP Schedule End Date
                                        <sup
                                            [class.opacity-0]="
                                                auditProgramForm.get(
                                                    'frequency_id'
                                                ).value == null
                                            "
                                            >*</sup
                                        ></label
                                    >
                                    <p-calendar
                                        appendTo="body"
                                        id="next_run"
                                        [showIcon]="true"
                                        [showButtonBar]="true"
                                        formControlName="next_run"
                                        [minDate]="
                                            auditProgramForm.get(
                                                'ap_schedule_date'
                                            ).value
                                        "
                                    ></p-calendar>
                                </div>
                            </div>
                        </div>
                    </form>
                </ng-template>

                <ng-template pTemplate="footer">
                    <button
                        pButton
                        pRipple
                        label="Cancel"
                        icon="pi pi-times"
                        class="p-button-text"
                        (click)="auditProgramDialog = false"
                    ></button>
                    <button
                        pButton
                        pRipple
                        #submitButton
                        label="Save"
                        icon="pi pi-check"
                        class="p-button-text"
                        (click)="saveAudit()"
                        [disabled]="auditProgramForm.invalid"
                    ></button>
                </ng-template>
            </p-dialog>

            <p-dialog
                [(visible)]="auditTestDialog"
                [style]="{ width: '89%', height: '89%' }"
                header="Audit Test Details"
                [modal]="true"
                class="p-fluid"
            >
                <ng-template pTemplate="content">
                    <form [formGroup]="auditTestForm">
                        <div class="grid">
                            <div class="col">
                                <div class="col">
                                    <div class="grid">
                                        <div class="col align-self-center">
                                            <div class="field">
                                                <label for="audit_test_desc"
                                                    >Audit Test Description
                                                    <sup>*</sup></label
                                                >
                                                <input
                                                    id="audit_test_desc"
                                                    pInputText
                                                    formControlName="audit_test_desc"
                                                    (click)="
                                                        getText(
                                                            auditTestForm.get(
                                                                'audit_test_desc'
                                                            ).value,
                                                            auditTestForm,
                                                            'audit_test_desc',
                                                            'Audit Test Description'
                                                        )
                                                    "
                                                />
                                            </div>
                                        </div>
                                        <div
                                            style="width: 205px !important"
                                        ></div>
                                        <div class="col align-self-center">
                                            <div class="field">
                                                <label for="au_id"
                                                    >Banner UID
                                                    <sup>*</sup></label
                                                >
                                                <p-autoComplete
                                                    appendTo="body"
                                                    placeholder="Search"
                                                    [dropdown]="true"
                                                    [multiple]="false"
                                                    [suggestions]="
                                                        filteredBanner
                                                    "
                                                    (completeMethod)="
                                                        filterBanner($event)
                                                    "
                                                    formControlName="banner_id"
                                                    [disabled]="
                                                        auditTestMode == 'edit'
                                                    "
                                                ></p-autoComplete>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid">
                                        <div class="col align-self-center">
                                            <div class="field">
                                                <label for="au_id"
                                                    >Audit Universe L4
                                                    <sup>*</sup></label
                                                >
                                                <p-autoComplete
                                                    appendTo="body"
                                                    placeholder="Search"
                                                    [dropdown]="true"
                                                    [showTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [hideTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [multiple]="false"
                                                    [suggestions]="
                                                        filteredAuditUniverse4
                                                    "
                                                    (completeMethod)="
                                                        filterAuditUniverse4(
                                                            $event
                                                        )
                                                    "
                                                    formControlName="au_level_4_id"
                                                    (onSelect)="
                                                        onAuditUniverse4Select(
                                                            $event
                                                        );
                                                        isRiskEnable = false
                                                    "
                                                    [autoHighlight]="true"
                                                    [forceSelection]="true"
                                                    [completeOnFocus]="true"
                                                ></p-autoComplete>
                                                <small
                                                    *ngIf="
                                                        auditUniverse4?.length ==
                                                        0
                                                    "
                                                    class="p-error"
                                                    >No scripts found with
                                                    related Audit program AU
                                                    Level 3</small
                                                >
                                            </div>
                                            <div class="field">
                                                <label for="au_id"
                                                    >Risk <sup>*</sup></label
                                                >
                                                <p-progressSpinner
                                                    *ngIf="loadingRisk"
                                                    [style]="{
                                                        width: '40px',
                                                        height: '40px'
                                                    }"
                                                    styleClass="custom-spinner"
                                                    strokeWidth="8"
                                                    animationDuration=".5s"
                                                ></p-progressSpinner>
                                                <p-autoComplete
                                                    *ngIf="!loadingRisk"
                                                    placeholder="Search"
                                                    [dropdown]="true"
                                                    [showTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [hideTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [multiple]="false"
                                                    [suggestions]="filteredRisk"
                                                    (completeMethod)="
                                                        filterRisk($event)
                                                    "
                                                    formControlName="risk_id"
                                                    [disabled]="isRiskEnable"
                                                    (onSelect)="
                                                        onRiskSelect($event);
                                                        isControlEnable = false
                                                    "
                                                ></p-autoComplete>
                                                <span *ngIf="!isRiskEnable">
                                                    <small
                                                        *ngIf="
                                                            riskd?.length == 0
                                                        "
                                                        class="p-error"
                                                        >No Risk Found</small
                                                    >
                                                </span>
                                            </div>
                                        </div>
                                        <div class="hexagon-wrapper">
                                            <button
                                                #submitButtonaudit
                                                class="hexagon"
                                                (click)="saveAuditTest()"
                                                [disabled]="
                                                    auditTestForm.invalid
                                                "
                                            >
                                                <span>Save Audit Test</span>
                                            </button>
                                        </div>
                                        <div class="col align-self-center">
                                            <div class="field">
                                                <label for="au_id"
                                                    >Control <sup>*</sup></label
                                                >
                                                <p-progressSpinner
                                                    *ngIf="loadingControl"
                                                    [style]="{
                                                        width: '40px',
                                                        height: '40px'
                                                    }"
                                                    styleClass="custom-spinner"
                                                    strokeWidth="8"
                                                    animationDuration=".5s"
                                                ></p-progressSpinner>
                                                <p-autoComplete
                                                    *ngIf="!loadingControl"
                                                    placeholder="Search"
                                                    [showTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [hideTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [dropdown]="true"
                                                    [multiple]="false"
                                                    [suggestions]="
                                                        filteredControl
                                                    "
                                                    (completeMethod)="
                                                        filterControl($event)
                                                    "
                                                    formControlName="control_id"
                                                    [disabled]="isControlEnable"
                                                    (onSelect)="
                                                        onControlSelect($event);
                                                        isScriptEnable = false
                                                    "
                                                ></p-autoComplete>
                                                <span *ngIf="!isControlEnable">
                                                    <small
                                                        *ngIf="
                                                            controld?.length ==
                                                            0
                                                        "
                                                        class="p-error"
                                                        >No Control Found</small
                                                    >
                                                </span>
                                            </div>
                                            <div class="field">
                                                <label for="au_id"
                                                    >Script <sup>*</sup></label
                                                >
                                                <p-progressSpinner
                                                    *ngIf="loadingScript"
                                                    [style]="{
                                                        width: '40px',
                                                        height: '40px'
                                                    }"
                                                    styleClass="custom-spinner"
                                                    strokeWidth="8"
                                                    animationDuration=".5s"
                                                ></p-progressSpinner>
                                                <p-autoComplete
                                                    *ngIf="!loadingScript"
                                                    appendTo="body"
                                                    placeholder="Search"
                                                    [showTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [hideTransitionOptions]="
                                                        '0ms'
                                                    "
                                                    [dropdown]="true"
                                                    [multiple]="false"
                                                    [suggestions]="
                                                        filteredScript
                                                    "
                                                    (completeMethod)="
                                                        filterScript($event)
                                                    "
                                                    formControlName="script_id"
                                                    (onSelect)="
                                                        onSelectScript($event)
                                                    "
                                                    [disabled]="isScriptEnable"
                                                ></p-autoComplete>
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        *ngIf="noScript"
                                        class="text-center text-xl"
                                    >
                                        <span class="text-pink-500"
                                            >There are no active scripts for
                                            this combination</span
                                        >
                                    </div>
                                </div>
                                <div>
                                    <table class="selectedVal">
                                        <tr>
                                            <td style="width: 20% !important">
                                                Audit Universe L4
                                            </td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.auditTestForm.get(
                                                            'au_level_4_id'
                                                        ).value,
                                                        'Audit Universe L4'
                                                    )
                                                "
                                            >
                                                {{
                                                    this.auditTestForm.get(
                                                        'au_level_4_id'
                                                    ).value
                                                }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Risk Description</td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.auditTestForm.get(
                                                            'risk_id'
                                                        ).value,
                                                        'Risk'
                                                    )
                                                "
                                            >
                                                {{
                                                    this.auditTestForm.get(
                                                        'risk_id'
                                                    ).value
                                                }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Control Description</td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.auditTestForm.get(
                                                            'control_id'
                                                        ).value,
                                                        'Control'
                                                    )
                                                "
                                            >
                                                {{
                                                    this.auditTestForm.get(
                                                        'control_id'
                                                    ).value
                                                }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Script Description</td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.auditTestForm.get(
                                                            'script_id'
                                                        ).value,
                                                        'Script'
                                                    )
                                                "
                                            >
                                                {{
                                                    this.auditTestForm.get(
                                                        'script_id'
                                                    ).value
                                                }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Presto Script</td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.scriptSelection
                                                            .script_presto,
                                                        'Presto Script'
                                                    )
                                                "
                                            >
                                                <div *ngIf="scriptSelection">
                                                    {{
                                                        this.scriptSelection
                                                            .script_presto
                                                    }}
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>SQL Script</td>
                                            <td
                                                title="Click to view full detail"
                                                style="
                                                    width: 70% !important;

                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                "
                                                (click)="
                                                    showScript(
                                                        this.scriptSelection
                                                            .script_sql,
                                                        'SQL Script'
                                                    )
                                                "
                                            >
                                                <div *ngIf="scriptSelection">
                                                    {{
                                                        this.scriptSelection
                                                            .script_sql
                                                    }}
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <br />
                                <div
                                    style="display: table"
                                    class="selectedVal"
                                    *ngIf="
                                        scriptSelection && script?.length > 0
                                    "
                                >
                                    <div *ngIf="scriptSelection">
                                        <div
                                            formArrayName="scriptVariables"
                                            *ngFor="
                                                let item of auditTestForm.get(
                                                    'scriptVariables'
                                                ).controls;
                                                let i = index
                                            "
                                        >
                                            <div
                                                class="grid align-items-baseline"
                                                *ngIf="
                                                    !scriptDefaultVariables.includes(
                                                        scriptSelection
                                                            .scriptVaribales[i]
                                                            .var_name
                                                    )
                                                "
                                            >
                                                <div class="col font-bold">
                                                    {{
                                                        scriptSelection
                                                            .scriptVaribales[i]
                                                            .var_name
                                                    }}
                                                </div>
                                                <div class="col font-bold">
                                                    {{
                                                        scriptSelection
                                                            .scriptVaribales[i]
                                                            .var_datatype
                                                    }}
                                                </div>
                                                <div
                                                    class="col"
                                                    [formGroupName]="i"
                                                >
                                                    <div class="field">
                                                        <input
                                                            pInputText
                                                            formControlName="var_value"
                                                            placeholder="Variable Value"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </ng-template>

                <ng-template pTemplate="footer">
                    <button
                        pButton
                        pRipple
                        label="Cancel"
                        icon="pi pi-times"
                        class="p-button-text"
                        (click)="auditTestDialog = false"
                    ></button>
                </ng-template>
            </p-dialog>

            <div
                *ngIf="
                    auditTHSelection?.length == 1 &&
                    auditTSelection?.length > 0 &&
                    auditPSelection?.length > 0 &&
                    auditTHSelection[0].job_run_status == 5
                "
                class="mt-2"
            >
                <form
                    *ngIf="auditTestHistoryForm"
                    [formGroup]="auditTestHistoryForm"
                    (ngSubmit)="saveTestHistory()"
                >
                    <div
                        *ngIf="
                            auditTestHistoryForm.value.results;
                            else resultError
                        "
                    >
                        <div class="grid">
                            <div class="col-8 align-self-center">
                                <div class="grid">
                                    <div class="col align-self-center">
                                        <div
                                            class="border-1 border-round-lg p-3 text-center"
                                        >
                                            <strong
                                                >Audit Universe Level 4 :
                                            </strong>
                                            <span>{{
                                                auditTHSelection[0]
                                                    .au_level_4_desc
                                            }}</span>
                                        </div>
                                        <div
                                            class="border-1 border-round-lg p-3 text-center mt-1"
                                        >
                                            <strong>Risk : </strong>
                                            <span
                                                >{{
                                                    auditTHSelection[0].risk_uid
                                                }}
                                                -
                                                {{
                                                    auditTHSelection[0]
                                                        .audit_risk
                                                }}</span
                                            >
                                        </div>
                                        <div
                                            class="border-1 border-round-lg p-3 text-center mt-1"
                                        >
                                            <strong>Store : </strong>
                                            <span>{{
                                                auditTHSelection[0].store
                                            }}</span>
                                        </div>
                                    </div>
                                    <div class="col align-self-center">
                                        <div class="field">
                                            <div class="hexagon-wrapper">
                                                <button
                                                    class="hexagon"
                                                    type="button"
                                                    (click)="
                                                        changeHistoryStatus(
                                                            auditTestHistoryForm
                                                                .value.results
                                                        )
                                                    "
                                                >
                                                    <span>{{
                                                        auditTestHistoryForm
                                                            .value.results ==
                                                        null
                                                            ? ''
                                                            : auditTestHistoryForm
                                                                  .value.results
                                                    }}</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col align-self-center">
                                        <div
                                            class="border-1 border-round-lg p-3 text-center"
                                        >
                                            <strong>Control : </strong>
                                            <span
                                                >{{
                                                    auditTHSelection[0]
                                                        .control_uid
                                                }}
                                                -
                                                {{
                                                    auditTHSelection[0].control
                                                }}
                                            </span>
                                        </div>
                                        <div
                                            class="border-1 border-round-lg p-3 text-center mt-1"
                                        >
                                            <strong>Script : </strong>
                                            <span
                                                >{{
                                                    auditTHSelection[0]
                                                        .script_uid
                                                }}
                                                -
                                                {{
                                                    auditTHSelection[0]
                                                        .script_defination
                                                }}
                                            </span>
                                        </div>
                                        <div
                                            class="border-1 border-round-lg p-3 text-center mt-1"
                                        >
                                            <strong>Run Date : </strong>
                                            <span>{{
                                                auditTHSelection[0].run_datetime
                                                    | date
                                            }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4 align-self-center">
                                <div class="field">
                                    <div class="mb-2">
                                        <label for="notes">Note</label>
                                    </div>
                                    <textarea
                                        rows="5"
                                        cols="40"
                                        id="notes"
                                        pInputText
                                        formControlName="notes"
                                    >
                                    </textarea>
                                </div>
                                <div>
                                    <button
                                        pButton
                                        pRipple
                                        label="Save"
                                        #submitButtonaudith
                                        icon="pi pi-check"
                                        class="p-button-text"
                                        type="submit"
                                    ></button>
                                    <button
                                        pButton
                                        pRipple
                                        label="Cancel"
                                        icon="pi pi-times"
                                        class="p-button-text"
                                        (click)="auditTHSelection = []"
                                    ></button>
                                    <button
                                        type="button"
                                        label="Results"
                                        class="p-element p-ripple p-button-rounded p-button-info p-button p-component"
                                        (click)="viewResults()"
                                    >
                                        <span class="p-button-label"
                                            >View Data Results</span
                                        ><span
                                            class="p-ink"
                                            style="
                                                height: 64px;
                                                width: 64px;
                                                top: -9.25px;
                                                left: -6.32812px;
                                            "
                                        ></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <ng-template #resultError>
                        <div
                            class="flex align-items-center justify-content-center w-3"
                        >
                            <div>
                                <strong class="text-4xl">Error: </strong>
                                <br />
                                <div>Error in executing Script</div>
                            </div>
                        </div>
                    </ng-template>
                </form>
            </div>

            <div
                *ngIf="
                    auditTHSelection?.length == 1 &&
                    auditTSelection?.length > 0 &&
                    auditPSelection?.length > 0 &&
                    auditTHSelection[0].job_run_status != 5
                "
                class="mt-2 text-center"
            >
                Job is {{ auditTHSelection[0].job_run_status_text }}
            </div>
        </div>
    </div>
    <div *ngIf="loadingF" class="loader">
        <p-progressSpinner strokeWidth="10"></p-progressSpinner>
    </div>
</div>

<p-confirmDialog
    header="Confirmation"
    icon="pi pi-exclamation-triangle"
></p-confirmDialog>

<p-dialog
    [(visible)]="graphDialog"
    [style]="{ width: '800px' }"
    header="Graph"
    [modal]="true"
    class="p-fluid"
>
    <ng-template pTemplate="content">
        <div class="grid">
            <div class="col">
                <p-chart
                    *ngIf="showGraph1; else noGraph1"
                    type="pie"
                    [data]="chartData1"
                    [options]="basicOptions"
                ></p-chart>
                <ng-template #noGraph1>
                    <div class="text-center text-4xl">No Graph</div>
                </ng-template>
                <div class="text-center m-2 text-2xl font-bold">AP Level</div>
            </div>
            <div class="col">
                <p-chart
                    *ngIf="showGraph1; else noGraph2"
                    type="pie"
                    [data]="chartData2"
                    [options]="basicOptions"
                ></p-chart>
                <ng-template #noGraph2>
                    <div class="text-center text-4xl">No Graph</div>
                </ng-template>
                <div class="text-center m-2 text-2xl font-bold">AT Level</div>
            </div>
        </div>
    </ng-template>
</p-dialog>

<p-dialog
    [(visible)]="showScriptPop"
    [header]="showScriptPopTitle"
    [modal]="true"
>
    <ng-template pTemplate="content">
        <textarea
            [value]="showScriptContent"
            cols="90"
            rows="40"
            disabled
        ></textarea>
    </ng-template>
</p-dialog>

<p-dialog
    #textDialog
    [header]="popupHeader"
    [(visible)]="showPopupText"
    [modal]="true"
>
    <ng-template pTemplate="content">
        <form [formGroup]="textDialogForm">
            <textarea
                autofocus
                name=""
                id=""
                cols="100"
                rows="40"
                formControlName="input"
            ></textarea>
        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <button
            pButton
            pRipple
            label="Ok"
            icon="pi pi-check"
            class="p-button-text"
            (click)="showPopupText = false"
        ></button>
    </ng-template>
</p-dialog> -->

<div id="table1">
    <p-table
        *ngIf="audits"
        #dt1
        [value]="auditP"
        selectionMode="single"
        [rows]="10"
        [loading]="loadingP"
        [rowHover]="true"
        [paginator]="true"
        [rowsPerPageOptions]="[5, 10, 20]"
        [showCurrentPageReport]="true"
        [(selection)]="auditPSelection"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        responsiveLayout="scroll"
        [scrollable]="true"
    >
    </p-table>
</div>
