<!-- <div class="grid">
    <div class="col-12">
        <div class="card">
            <p-toast></p-toast>

            <p-table
                #dt
                [value]="risks"
                dataKey="risk_uid"
                [rows]="10"
                [loading]="loading"
                [rowHover]="true"
                styleClass="p-datatable-gridlines"
                [paginator]="true"
                [globalFilterFields]="[
                    'risk_uid',
                    'au_level_3_uid',
                    'process',
                    'business_objective',
                    'risk',
                    'comment',
                    'impact',
                    'likelihood',
                    'risk_score',
                    'risk_exposure'
                ]"
                [rowsPerPageOptions]="[10, 20, 30]"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                [(selection)]="selectedrisks"
                responsiveLayout="scroll"
                [scrollable]="true"
                scrollHeight="calc(100vh - 220px)"
            >
                <ng-template pTemplate="caption">
                    <div
                        class="grid grid-nogutter flex-column md:flex-row justify-content-between"
                    >
                        <h6 class="m-0">RISK</h6>

                        <span class="p-input-icon-left mb-2 md:mb-0">
                            <button
                                title="New"
                                pButton
                                pRipple
                                icon="pi pi-plus"
                                class="p-button-rounded p-button-success"
                                *ngIf="accountSvr.checkPermission(2, 4, 'A')"
                                (click)="openNew()"
                            ></button>

                            &nbsp;

                            <button
                                title="Edit"
                                pButton
                                pRipple
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning"
                                *ngIf="accountSvr.checkPermission(2, 4, 'C')"
                                (click)="editrisk()"
                                [disabled]="selectedrisks?.length != 1"
                            ></button>
                            &nbsp;
                            <button
                                title="Delete"
                                pButton
                                pRipple
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger"
                                (click)="deleteSelectedrisks()"
                                *ngIf="accountSvr.checkPermission(2, 4, 'D')"
                                [disabled]="selectedrisks?.length != 1"
                            ></button>
                            &nbsp;
                            <button
                                title="Clear"
                                pButton
                                pRipple
                                class="p-button-rounded p-button-info"
                                icon=" pi pi-filter-slash"
                                (click)="clear(dt)"
                            ></button>
                        </span>
                    </div>
                </ng-template>
                <ng-template
                    pTemplate="header"
                    *ngIf="accountSvr.checkPermission(2, 4, 'V')"
                >
                    <tr>
                        <th pFrozenColumn style="max-width: 3rem"></th>
                        <th pSortableColumn="risk_uid">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="risk_uid"></p-sortIcon>
                                RISK UID
                                <p-columnFilter
                                    type="text"
                                    field="risk_uid"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="auldesc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="auldesc"></p-sortIcon>
                                AU LEVEL 3 DESCRIPTION
                                <p-columnFilter
                                    type="text"
                                    field="auldesc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="process">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="process"></p-sortIcon>
                                PROCESS
                                <p-columnFilter
                                    type="text"
                                    field="process"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="business_objective">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon
                                    field="business_objective"
                                ></p-sortIcon>
                                BUSINESS OBJECTIVE
                                <p-columnFilter
                                    type="text"
                                    field="business_objective"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="risk">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="risk"></p-sortIcon>
                                AUDIT RISK
                                <p-columnFilter
                                    type="text"
                                    field="risk"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>

                        <th pSortableColumn="rtonedesc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="rtonedesc"></p-sortIcon>
                                RISK CATEGORY
                                <p-columnFilter
                                    type="text"
                                    field="rtonedesc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>

                        <th pSortableColumn="rttwodesc">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="rttwodesc"></p-sortIcon>
                                RISK TYPE
                                <p-columnFilter
                                    type="text"
                                    field="rttwodesc"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="comment">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="comment"></p-sortIcon>
                                COMMENTS
                                <p-columnFilter
                                    type="text"
                                    field="comment"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="impact">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="impact"></p-sortIcon>
                                IMPACT
                                <p-columnFilter
                                    type="text"
                                    field="impact"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="likelihood">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="likelihood"></p-sortIcon>
                                LIKELIHOOD
                                <p-columnFilter
                                    type="text"
                                    field="likelihood"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="risk_score">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="risk_score"></p-sortIcon>
                                RISK SCORE
                                <p-columnFilter
                                    type="text"
                                    field="risk_score"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                        <th pSortableColumn="risk_exposure">
                            <div
                                class="flex justify-content-between align-items-center"
                            >
                                <p-sortIcon field="risk_exposure"></p-sortIcon>
                                RISK EXPOSURE
                                <p-columnFilter
                                    type="text"
                                    field="risk_exposure"
                                    display="menu"
                                ></p-columnFilter>
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-risk>
                    <tr>
                        <td pFrozenColumn style="max-width: 3rem">
                            <p-tableCheckbox
                                [value]="risk"
                                (click)="selectRisk(risk)"
                            ></p-tableCheckbox>
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.risk_uid }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.auldesc }}
                        </td>
                        <td
                            style="min-width: 12rem"
                            class="cursor-pointer"
                            (click)="showInDetail(risk.process, 'Process')"
                            title="Click to view full detail"
                        >
                            {{ risk.process.slice(0, 20) }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.business_objective }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.risk }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.rtax1 }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.rtax2 }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.comment }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.impact }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.likelihood }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.risk_score }}
                        </td>
                        <td style="min-width: 12rem">
                            {{ risk.codetext }}
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7">No risks found.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="7">Loading risks data. Please wait.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <p-dialog
            [(visible)]="riskDialog"
            [style]="{ width: '80%' }"
            header="Risk Detail"
            [modal]="true"
            class="p-fluid"
        >
            <ng-template pTemplate="content">
                <form [formGroup]="form">
                    <div class="p-fluid p-formgrid grid">
                        <div class="field col-12 md:col-4">
                            <label for="au_level_3_uid"
                                >AU Level-3 UID <sup>*</sup></label
                            >
                            <p-autoComplete
                                formControlName="auldesc"
                                [ngModelOptions]="{ standalone: true }"
                                (onSelect)="doOnSelectaudit3($event)"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                placeholder="Search"
                                id="au_level_3_uid"
                                [dropdown]="true"
                                [suggestions]="filteredAuThird"
                                (completeMethod)="filterAuThird($event)"
                                required
                                autofocus
                                [(ngModel)]="risk.auldesc"
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.auldesc
                                }"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.auldesc.invalid &&
                                    form.controls.auldesc.dirty
                                "
                                >AU Level-3 UID is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="process">Process <sup>*</sup></label>
                            <input
                                formControlName="process"
                                [(ngModel)]="risk.process"
                                [ngModelOptions]="{ standalone: true }"
                                id="process"
                                pInputText
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.process
                                }"
                                (click)="
                                    getText(
                                        form.get('process').value,
                                        form,
                                        'process',
                                        'Process'
                                    )
                                "
                            />
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.process.invalid &&
                                    form.controls.process.dirty
                                "
                                >Process is required.</small
                            >
                        </div>
                        <div class="field col-12 md:col-4">
                            <label for="business_objective"
                                >Business Objective <sup>*</sup></label
                            >
                            <input
                                formControlName="business_objective"
                                [ngModelOptions]="{ standalone: true }"
                                id="business_objective"
                                pInputText
                                required
                                autofocus
                                [(ngModel)]="risk.business_objective"
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted &&
                                        !form.controls.business_objective
                                }"
                                (click)="
                                    getText(
                                        form.get('business_objective').value,
                                        form,
                                        'business_objective',
                                        'Business Objective'
                                    )
                                "
                            />
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.business_objective.invalid &&
                                    form.controls.business_objective.dirty
                                "
                                >Business Objective is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="comment">Comments <sup>*</sup></label>
                            <input
                                formControlName="comment"
                                [ngModelOptions]="{ standalone: true }"
                                id="comment"
                                pInputText
                                required
                                [(ngModel)]="risk.comment"
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.comment
                                }"
                                autofocus
                                (click)="
                                    getText(
                                        form.get('comment').value,
                                        form,
                                        'comment',
                                        'Comments'
                                    )
                                "
                            />
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.comment.invalid &&
                                    form.controls.comment.dirty
                                "
                                >Comment is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="risk">Audit Risk <sup>*</sup></label>
                            <input
                                formControlName="risk"
                                [ngModelOptions]="{ standalone: true }"
                                id="risk"
                                [(ngModel)]="risk.risk"
                                pInputText
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.risk
                                }"
                                (click)="
                                    getText(
                                        form.get('risk').value,
                                        form,
                                        'risk',
                                        'Audit Risk'
                                    )
                                "
                            />
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.risk.invalid &&
                                    form.controls.risk.dirty
                                "
                                >Risk is required.</small
                            >
                        </div>
                        <div class="field col-12 md:col-4"></div>

                        <div class="field col-12 md:col-4">
                            <label for="risk">Risk Category <sup>*</sup></label>
                            <p-autoComplete
                                formControlName="rtonedesc"
                                [ngModelOptions]="{ standalone: true }"
                                appendTo="body"
                                [(ngModel)]="risk.rtonedesc"
                                (onSelect)="doOnSelectrtax1($event)"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                placeholder="Search"
                                id="rt_level_1_uid"
                                [dropdown]="true"
                                [suggestions]="filteredRisktaxone"
                                (completeMethod)="filterRisktaxone($event)"
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.rtonedesc
                                }"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.rtonedesc.invalid &&
                                    form.controls.rtonedesc.dirty
                                "
                                >Risk Category is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="risk">Risk Type <sup>*</sup></label>
                            <p-autoComplete
                                formControlName="rttwodesc"
                                [(ngModel)]="risk.rttwodesc"
                                [ngModelOptions]="{ standalone: true }"
                                (onSelect)="doOnSelectrtax2($event)"
                                [minLength]="1"
                                placeholder="Search"
                                id="rt_level_2_id"
                                [dropdown]="true"
                                [suggestions]="filteredRisktaxtwo"
                                (completeMethod)="filterRisktaxtwo($event)"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.rttwodesc
                                }"
                                [disabled]="!selectedrtax1?.length > 0"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.rttwodesc.invalid &&
                                    form.controls.rttwodesc.dirty
                                "
                                >Risk Type is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="risk_exposure"
                                >Risk Exposure <sup>*</sup></label
                            >
                            <p-autoComplete
                                formControlName="coddesc"
                                [(ngModel)]="risk.coddesc"
                                [ngModelOptions]="{ standalone: true }"
                                (onSelect)="doOnSelectexposure($event)"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                placeholder="Search"
                                id="text_code_value"
                                [dropdown]="true"
                                [suggestions]="filteredRiskExposure"
                                (completeMethod)="filterRiskExposure($event)"
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.coddesc
                                }"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.coddesc.invalid &&
                                    form.controls.coddesc.dirty
                                "
                                >Risk Exposure is required.</small
                            >
                        </div>

                        <div class="field col-12 md:col-4">
                            <label for="impact">Impact <sup>*</sup></label>
                            <p-autoComplete
                                formControlName="impact"
                                [(ngModel)]="risk.impact"
                                [ngModelOptions]="{ standalone: true }"
                                appendTo="body"
                                (onSelect)="doOnSelectimpact($event)"
                                [suggestions]="filteredlikelihood"
                                appendToBody="true"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                placeholder="Search"
                                id="rt_impact"
                                [dropdown]="true"
                                [suggestions]="filteredimpact"
                                (completeMethod)="filterimpact($event)"
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.impact
                                }"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.impact.invalid &&
                                    form.controls.impact.dirty
                                "
                                >Impact is required.</small
                            >
                        </div>
                        <div class="field col-12 md:col-4">
                            <label for="likelihood"
                                >Likelihood <sup>*</sup></label
                            >
                            <p-autoComplete
                                formControlName="likelihood"
                                [(ngModel)]="risk.likelihood"
                                [ngModelOptions]="{ standalone: true }"
                                appendTo="body"
                                (onSelect)="doOnSelectlikelihood($event)"
                                placeholder="Search"
                                id="rt_level_2_id"
                                [dropdown]="true"
                                [suggestions]="filteredlikelihood"
                                appendToBody="true"
                                [autoHighlight]="true"
                                [forceSelection]="true"
                                [completeOnFocus]="true"
                                [minLength]="1"
                                (completeMethod)="filterlikelihood($event)"
                                required
                                autofocus
                                [ngClass]="{
                                    'ng-invalid ng-dirty':
                                        submitted && !form.controls.likelihood
                                }"
                            >
                            </p-autoComplete>
                            <small
                                class="ng-dirty ng-invalid"
                                *ngIf="
                                    form.controls.likelihood.invalid &&
                                    form.controls.likelihood.dirty
                                "
                                >Likelihood is required.</small
                            >
                        </div>
                        <div class="field col-12 md:col-4">
                            <label for="risk_score"
                                >Risk Score <sup>*</sup></label
                            >
                            <input
                                [ngModelOptions]="{ standalone: true }"
                                id="risk_score"
                                [readonly]="true"
                                pInputText
                                [value]="selectedtotal"
                                required
                                autofocus
                            />
                        </div>
                    </div>
                </form>
            </ng-template>

            <ng-template pTemplate="footer">
                <button
                    pButton
                    pRipple
                    label="Cancel"
                    icon="pi pi-times"
                    class="p-button-text"
                    (click)="hideDialog()"
                ></button>
                <button
                    pButton
                    pRipple
                    label="Save"
                    #submitButton
                    icon="pi pi-check"
                    class="p-button-text"
                    (click)="saverisk()"
                    [disabled]="!form.valid"
                ></button>
            </ng-template>
        </p-dialog>

        <p-confirmDialog> </p-confirmDialog>
    </div>
</div> -->

<p-dialog
    #textDialog
    [header]="popupHeader"
    [(visible)]="showPopupText"
    [modal]="true"
>
    <ng-template pTemplate="content">
        <form [formGroup]="textDialogForm">
            <textarea
                autofocus
                name=""
                id=""
                cols="100"
                rows="40"
                formControlName="input"
            ></textarea>
        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <button
            pButton
            pRipple
            label="Ok"
            icon="pi pi-check"
            class="p-button-text"
            (click)="showPopupText = false"
        ></button>
    </ng-template>
</p-dialog>

<p-confirmDialog> </p-confirmDialog>

<p-dialog [(visible)]="showPop" [header]="showPopTitle" [modal]="true">
    <ng-template pTemplate="content">
        <textarea [value]="showContent" cols="90" rows="40" disabled></textarea>
    </ng-template>
</p-dialog>

<div id="table1">
    <p-table
        #dt
        [value]="risks"
        [(selection)]="selectedrisks"
        [rowHover]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        [rowsPerPageOptions]="[10, 25, 50]"
        [loading]="loading"
        [paginator]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [filterDelay]="0"
        [scrollable]="true"
        scrollHeight="calc(100vh - 240px)"
        [tableStyle]="{ 'min-width': '50rem' }"
        [globalFilterFields]="[
            'risk_uid',
            'auldesc',
            'process',
            'business_objective',
            'risk',
            'rtax1',
            'rtax2',
            'comment',
            'impact',
            'likelihood',
            'risk_score',
            'codetext'
        ]"
    >
        <ng-template pTemplate="caption">
            <div
                class="table-header flex justify-content-between align-items-center"
            >
                <span>Risk</span>
                <span class="flex justify-content-between align-items-center">
                    <span class="p-input-icon-left mr-5">
                        <i class="pi pi-search"></i>
                        <input
                            pInputText
                            type="text"
                            (input)="
                                dt.filterGlobal($event.target.value, 'contains')
                            "
                            placeholder="Global Search"
                        />
                    </span>
                    <!-- <span class="p-input-icon-left mb-2 md:mb-0">
                        <button
                            title="New"
                            pButton
                            pRipple
                            icon="pi pi-plus"
                            class="p-button-rounded p-button-success"
                            (click)="openNew()"
                        ></button>

                        &nbsp;

                        <button
                            title="Edit"
                            pButton
                            pRipple
                            icon="pi pi-pencil"
                            class="p-button-rounded p-button-warning"
                            (click)="editrisk()"
                            [disabled]="selectedrisks?.length != 1"
                        ></button>
                        &nbsp;
                        <button
                            title="Delete"
                            pButton
                            pRipple
                            icon="pi pi-trash"
                            class="p-button-rounded p-button-danger"
                            (click)="deleteSelectedrisks()"
                            [disabled]="selectedrisks?.length != 1"
                        ></button>
                        &nbsp;
                        <button
                            title="Clear"
                            pButton
                            pRipple
                            class="p-button-rounded p-button-info"
                            icon=" pi pi-filter-slash"
                            (click)="clear(dt)"
                        ></button> </span
                > -->
                </span>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="risk_uid" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Risk UID
                        <p-sortIcon field="risk_uid"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="auldesc" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        AU level 3 Description
                        <p-sortIcon field="auldesc"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="process" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Process
                        <p-sortIcon field="process"></p-sortIcon>
                    </div>
                </th>

                <th
                    pSortableColumn="business_objective"
                    style="min-width: 14rem"
                >
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Business Objective
                        <p-sortIcon field="business_objective"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="risk" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Audit Risk
                        <p-sortIcon field="risk"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="rtax1" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Risk Category
                        <p-sortIcon field="rtax1"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="rtax2" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Risk Type
                        <p-sortIcon field="rtax2"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="comment" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Comments
                        <p-sortIcon field="comment"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="impact" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Impact
                        <p-sortIcon field="impact"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="likelihood" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Likelihood
                        <p-sortIcon field="likelihood"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="risk_score" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Risk Score
                        <p-sortIcon field="risk_score"></p-sortIcon>
                    </div>
                </th>

                <th pSortableColumn="risk_exposure" style="min-width: 14rem">
                    <div
                        class="flex justify-content-between align-items-center"
                    >
                        Risk Exposure
                        <p-sortIcon field="risk_exposure"></p-sortIcon>
                    </div>
                </th>

                <th style="min-width: 14rem">Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-item>
            <tr class="p-selectable-row">
                <td>
                    <span class="p-column-title">Risk UID</span>
                    {{ item.risk_uid }}
                </td>

                <td>
                    <span class="p-column-title">AU level 3 Description</span>
                    {{ item.auldesc }}
                </td>

                <td>
                    <span class="p-column-title">Process</span>
                    {{ item.process }}
                </td>

                <td>
                    <span class="p-column-title">Business Objective</span>
                    {{ item.business_objective }}
                </td>

                <td>
                    <span class="p-column-title">Audit Risk</span>
                    {{ item.risk }}
                </td>

                <td>
                    <span class="p-column-title">Risk Category</span>
                    {{ item.rtax1 }}
                </td>

                <td>
                    <span class="p-column-title">Risk Type</span>
                    {{ item.rtax2 }}
                </td>

                <td>
                    <span class="p-column-title">Comment</span>
                    {{ item.comment }}
                </td>

                <td>
                    <span class="p-column-title">Impact</span>
                    {{ item.impact }}
                </td>

                <td>
                    <span class="p-column-title">Likelihood</span>
                    {{ item.likelihood }}
                </td>

                <td>
                    <span class="p-column-title">Risk Score</span>
                    {{ item.risk_score }}
                </td>

                <td>
                    <span class="p-column-title">Risk Exposure</span>
                    {{ item.codetext }}
                </td>

                <td style="min-width: 14rem">
                    <span class="p-column-title">Actions</span>
                    <span
                        ><button
                            pButton
                            pRipple
                            title="Edit"
                            type="button"
                            icon="pi pi-pencil"
                            class="p-button-rounded p-button-info"
                            (click)="editrisk(item)"
                        ></button>
                        <button
                            pButton
                            pRipple
                            title="Delete"
                            type="button"
                            icon="pi pi-trash"
                            class="p-button-rounded p-button-danger ml-2"
                            (click)="deleteSelectedrisks(item)"
                        ></button
                    ></span>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <button
        pButton
        pRipple
        title="Add"
        type="button"
        icon="pi pi-plus"
        class="p-button-rounded fixed add-banner-btn"
        (click)="openNew()"
    ></button>
</div>

<p-dialog
    [(visible)]="riskDialog"
    [style]="{ width: '80%' }"
    header="Risk Detail"
    [modal]="true"
    class="p-fluid"
>
    <ng-template pTemplate="content">
        <form [formGroup]="form">
            <div class="p-fluid p-formgrid grid">
                <div class="field col-12 md:col-4">
                    <label for="au_level_3_uid"
                        >AU Level-3 UID <sup>*</sup></label
                    >
                    <p-autoComplete
                        formControlName="auldesc"
                        [ngModelOptions]="{ standalone: true }"
                        (onSelect)="doOnSelectaudit3($event)"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        [minLength]="1"
                        placeholder="Search"
                        id="au_level_3_uid"
                        [dropdown]="true"
                        [suggestions]="filteredAuThird"
                        (completeMethod)="filterAuThird($event)"
                        required
                        autofocus
                        [(ngModel)]="risk.auldesc"
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.auldesc
                        }"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.auldesc.invalid &&
                            form.controls.auldesc.dirty
                        "
                        >AU Level-3 UID is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="process">Process <sup>*</sup></label>
                    <input
                        formControlName="process"
                        [(ngModel)]="risk.process"
                        [ngModelOptions]="{ standalone: true }"
                        id="process"
                        pInputText
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.process
                        }"
                        (click)="
                            getText(
                                form.get('process').value,
                                form,
                                'process',
                                'Process'
                            )
                        "
                    />
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.process.invalid &&
                            form.controls.process.dirty
                        "
                        >Process is required.</small
                    >
                </div>
                <div class="field col-12 md:col-4">
                    <label for="business_objective"
                        >Business Objective <sup>*</sup></label
                    >
                    <input
                        formControlName="business_objective"
                        [ngModelOptions]="{ standalone: true }"
                        id="business_objective"
                        pInputText
                        required
                        autofocus
                        [(ngModel)]="risk.business_objective"
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.business_objective
                        }"
                        (click)="
                            getText(
                                form.get('business_objective').value,
                                form,
                                'business_objective',
                                'Business Objective'
                            )
                        "
                    />
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.business_objective.invalid &&
                            form.controls.business_objective.dirty
                        "
                        >Business Objective is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="comment">Comments <sup>*</sup></label>
                    <input
                        formControlName="comment"
                        [ngModelOptions]="{ standalone: true }"
                        id="comment"
                        pInputText
                        required
                        [(ngModel)]="risk.comment"
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.comment
                        }"
                        autofocus
                        (click)="
                            getText(
                                form.get('comment').value,
                                form,
                                'comment',
                                'Comments'
                            )
                        "
                    />
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.comment.invalid &&
                            form.controls.comment.dirty
                        "
                        >Comment is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="risk">Audit Risk <sup>*</sup></label>
                    <input
                        formControlName="risk"
                        [ngModelOptions]="{ standalone: true }"
                        id="risk"
                        [(ngModel)]="risk.risk"
                        pInputText
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.risk
                        }"
                        (click)="
                            getText(
                                form.get('risk').value,
                                form,
                                'risk',
                                'Audit Risk'
                            )
                        "
                    />
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.risk.invalid &&
                            form.controls.risk.dirty
                        "
                        >Risk is required.</small
                    >
                </div>
                <div class="field col-12 md:col-4"></div>

                <div class="field col-12 md:col-4">
                    <label for="risk">Risk Category <sup>*</sup></label>
                    <p-autoComplete
                        formControlName="rtonedesc"
                        [ngModelOptions]="{ standalone: true }"
                        appendTo="body"
                        [(ngModel)]="risk.rtonedesc"
                        (onSelect)="doOnSelectrtax1($event)"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        [minLength]="1"
                        placeholder="Search"
                        id="rt_level_1_uid"
                        [dropdown]="true"
                        [suggestions]="filteredRisktaxone"
                        (completeMethod)="filterRisktaxone($event)"
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.rtonedesc
                        }"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.rtonedesc.invalid &&
                            form.controls.rtonedesc.dirty
                        "
                        >Risk Category is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="risk">Risk Type <sup>*</sup></label>
                    <p-autoComplete
                        formControlName="rttwodesc"
                        [(ngModel)]="risk.rttwodesc"
                        [ngModelOptions]="{ standalone: true }"
                        (onSelect)="doOnSelectrtax2($event)"
                        [minLength]="1"
                        placeholder="Search"
                        id="rt_level_2_id"
                        [dropdown]="true"
                        [suggestions]="filteredRisktaxtwo"
                        (completeMethod)="filterRisktaxtwo($event)"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.rttwodesc
                        }"
                        [disabled]="!selectedrtax1?.length > 0"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.rttwodesc.invalid &&
                            form.controls.rttwodesc.dirty
                        "
                        >Risk Type is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="risk_exposure"
                        >Risk Exposure <sup>*</sup></label
                    >
                    <p-autoComplete
                        formControlName="coddesc"
                        [(ngModel)]="risk.coddesc"
                        [ngModelOptions]="{ standalone: true }"
                        (onSelect)="doOnSelectexposure($event)"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        [minLength]="1"
                        placeholder="Search"
                        id="text_code_value"
                        [dropdown]="true"
                        [suggestions]="filteredRiskExposure"
                        (completeMethod)="filterRiskExposure($event)"
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.coddesc
                        }"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.coddesc.invalid &&
                            form.controls.coddesc.dirty
                        "
                        >Risk Exposure is required.</small
                    >
                </div>

                <div class="field col-12 md:col-4">
                    <label for="impact">Impact <sup>*</sup></label>
                    <p-autoComplete
                        formControlName="impact"
                        [(ngModel)]="risk.impact"
                        [ngModelOptions]="{ standalone: true }"
                        appendTo="body"
                        (onSelect)="doOnSelectimpact($event)"
                        [suggestions]="filteredlikelihood"
                        appendToBody="true"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        [minLength]="1"
                        placeholder="Search"
                        id="rt_impact"
                        [dropdown]="true"
                        [suggestions]="filteredimpact"
                        (completeMethod)="filterimpact($event)"
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.impact
                        }"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.impact.invalid &&
                            form.controls.impact.dirty
                        "
                        >Impact is required.</small
                    >
                </div>
                <div class="field col-12 md:col-4">
                    <label for="likelihood">Likelihood <sup>*</sup></label>
                    <p-autoComplete
                        formControlName="likelihood"
                        [(ngModel)]="risk.likelihood"
                        [ngModelOptions]="{ standalone: true }"
                        appendTo="body"
                        (onSelect)="doOnSelectlikelihood($event)"
                        placeholder="Search"
                        id="rt_level_2_id"
                        [dropdown]="true"
                        [suggestions]="filteredlikelihood"
                        appendToBody="true"
                        [autoHighlight]="true"
                        [forceSelection]="true"
                        [completeOnFocus]="true"
                        [minLength]="1"
                        (completeMethod)="filterlikelihood($event)"
                        required
                        autofocus
                        [ngClass]="{
                            'ng-invalid ng-dirty':
                                submitted && !form.controls.likelihood
                        }"
                    >
                    </p-autoComplete>
                    <small
                        class="ng-dirty ng-invalid"
                        *ngIf="
                            form.controls.likelihood.invalid &&
                            form.controls.likelihood.dirty
                        "
                        >Likelihood is required.</small
                    >
                </div>
                <div class="field col-12 md:col-4">
                    <label for="risk_score">Risk Score <sup>*</sup></label>
                    <input
                        [ngModelOptions]="{ standalone: true }"
                        id="risk_score"
                        [readonly]="true"
                        pInputText
                        [value]="selectedtotal"
                        required
                        autofocus
                    />
                </div>
            </div>
        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <button
            pButton
            pRipple
            label="Cancel"
            icon="pi pi-times"
            class="p-button-text"
            (click)="hideDialog()"
        ></button>
        <button
            pButton
            pRipple
            label="Save"
            #submitButton
            icon="pi pi-check"
            class="p-button-text"
            (click)="saverisk()"
            [disabled]="!form.valid"
        ></button>
    </ng-template>
</p-dialog>
